import{j as b}from"./jsx-runtime-qGIIFXMu.js";import{r as k,g as Ms}from"./index-CDs2tPxN.js";var Os=Object.defineProperty,Ue=(r,e,t)=>((n,s,o)=>s in n?Os(n,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[s]=o)(r,typeof e!="symbol"?e+"":e,t);class ce extends Error{constructor(e={}){super(e.message),Ue(this,"exceptionId"),Ue(this,"message"),Ue(this,"source"),Ue(this,"type"),this.message=e.message??"",this.source=e.source,this.type=this.constructor.name,this.exceptionId=e.exceptionId}}class he extends ce{}class at extends ce{}const U=r=>{typeof r!="string"?r&&typeof r.toString=="function"?console.warn(`[nlux] ${r.toString()}`):console.warn("[nlux]"):console.warn(`[nlux] ${r}`)},on=[],St=r=>{on.includes(r)||(on.push(r),U(r))},Zn=class rt{static register(e){const t=e.__compId;t?rt.componentDefs.get(t)===void 0&&(e.__renderer&&e.__updater?rt.componentDefs.set(t,{id:t,model:e,render:e.__renderer,update:e.__updater}):U(`Component with id "${t}" missing renderer or updater`)):U("Component definition missing valid id")}static retrieve(e){const t=rt.componentDefs.get(e);if(t)return t;U(`Component with id "${e}" not registered`)}};Zn.componentDefs=new Map;let Wn=Zn;btoa("sectionsRegistered")+"";const ne=r=>{const e=requestAnimationFrame(()=>{r()});return()=>{cancelAnimationFrame(e)}},De=r=>{r.replaceChildren()},se=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const e=16*Math.random()|0;return(r=="x"?e:3&e|8).toString(16)});class J{constructor(e,t){this.subComponentElementIds=new Map,this.subComponents=new Map,this.__context=null,this.__destroyed=!1,this.__status="unmounted",this.actionsOnDomReady=[],this.compEventGetter=i=>{if(this.destroyed)return()=>{};const a=this.rendererEventListeners.get(i);if(!a)throw new ce({source:this.constructor.name,message:`Unable to call renderer event "${i}" because no matching event listener was found. Make sure that the event listener is registered using @CompEventListener() decorator in the component model class, and use class methods instead of arrow function attributes.`});return a};const n=Object.getPrototypeOf(this).constructor.__compId;if(!n)throw new he({source:this.constructor.name,message:"Unable to instantiate component: missing compId in implementation. Component should be annotated using @Model() to set compId before iy can be instantiated."});if(this.def=Wn.retrieve(n)??null,!this.def)throw new he({source:this.constructor.name,message:`Unable to instantiate component "${n}" because it's not registered. Component should be registered using CompRegistry.register(ComponentClass) before instantiating a component.`});this.__instanceId=se(),this.__destroyed=!1,this.__context=e,this.renderedDom=null,this.renderingRoot=null,this.props=t;const s=t?Object.entries(t):[];this.elementProps=new Map(s),this.rendererEventListeners=new Map;const o=this.constructor.__compEventListeners;o&&o.forEach((i,a)=>{i.forEach(p=>{const c=Object.getPrototypeOf(this)[p];typeof c=="function"?this.addRendererEventListener(a,c.bind(this)):U(`Unable to set event listener "${a}" because method "${p}" cannot be found on component "${this.constructor.name} at runtime!"`)})}),this.rendererProps=Object.freeze(t)}get destroyed(){return this.__destroyed}get id(){return this.__instanceId}get rendered(){return this.renderedDom!==null}get root(){return this.throwIfDestroyed(),this.renderedDom&&this.renderingRoot?this.renderingRoot:null}get status(){return this.__status}get context(){if(!this.__context)throw new he({source:this.constructor.name,message:"Unable to get context because it's not set"});return this.__context}destroy(){this.destroyComponent()}destroyListItemComponent(){this.destroyComponent(!0)}getProp(e){return this.throwIfDestroyed(),this.elementProps.get(e)??null}render(e,t){var i;if(!this.def)return;if(this.destroyed)return void U(`Unable to render component "${(i=this.def)==null?void 0:i.id}" because it is already destroyed`);if(this.rendered||this.renderedDom)return void U(`Unable to render component "${this.def.id}" because it is already rendered`);const n=document.createDocumentFragment(),s=Object.getPrototypeOf(this).constructor.__compId,o=this.executeRenderer(n);if(!o)throw new ce({source:this.constructor.name,message:`Unable to render component "${s}" because renderer returned null`});this.renderedDom=o;for(const[,a]of this.subComponents){const p=this.getSubComponentPortal(a.id);p&&this.mountSubComponentToPortal(a.id,p)}ne(()=>{this.destroyed||(t?e.insertBefore(n,t):e.append(n),this.renderingRoot=e)})}updateSubComponent(e,t,n){this.throwIfDestroyed();const s=this.subComponents.get(e);s&&!s.destroyed&&s.setProp(t,n)}addSubComponent(e,t,n){if(this.throwIfDestroyed(),this.subComponents.has(e))throw new he({source:this.constructor.name,message:`Unable to add sub-component "${e}" because it already exists`});if(this.subComponents.set(e,t),n&&this.subComponentElementIds.set(e,n),this.renderedDom){const s=this.getSubComponentPortal(e);s&&this.mountSubComponentToPortal(e,s)}}executeDomAction(e,...t){if(this.throwIfDestroyed(),!this.renderedDom)return void this.actionsOnDomReady.push(()=>this.executeDomAction(e,...t));if(!this.renderingRoot)throw new ce({source:this.constructor.name,message:"Unable to execute DOM action because renderingRoot is not set"});const n=this.renderedDom.actions[e];if(!n)throw new ce({source:this.constructor.name,message:`Unable to execute DOM action "${String(e)}" because it does not exist`});return ne(()=>n(...t))}executeRenderer(e){var s;const t=(s=this.def)==null?void 0:s.render;if(!t)return null;if(this.renderingRoot)throw new ce({source:this.constructor.name,message:"Unable to render component because renderingRoot is already set"});const n=t({appendToRoot:o=>{e.append(o),this.runDomActionsQueue()},compEvent:this.compEventGetter,props:this.rendererProps,context:this.context});return n&&(this.renderingRoot=e),n}removeSubComponent(e){this.throwIfDestroyed(),ne(()=>{const t=this.subComponents.get(e);t&&(t.renderingRoot=null,t.destroy(),this.subComponents.delete(e))})}runDomActionsQueue(){if(this.actionsOnDomReady.length>0&&this.rendered){const e=this.actionsOnDomReady;this.actionsOnDomReady=[];for(const t of e)ne(()=>t())}}setProp(e,t){this.destroyed?U(`Unable to set prop "${String(e)}" because component "${this.constructor.name}" is destroyed`):this.elementProps.has(e)?(this.schedulePropUpdate(e,this.elementProps.get(e),t),this.props=Object.freeze(Object.fromEntries(this.elementProps)),this.elementProps.set(e,t)):U(`Unable to set prop "${String(e)}" because it does not exist in the component props`)}throwIfDestroyed(){if(this.__destroyed)throw new he({source:this.constructor.name,message:"Unable to call method on destroyed component"})}addRendererEventListener(e,t){if(this.throwIfDestroyed(),this.rendererEventListeners.has(e))throw new he({source:this.constructor.name,message:`Unable to add event listener to rendererEvents "${e}" because it already exists`});this.rendererEventListeners.set(e,t)}destroyComponent(e=!1){if(this.throwIfDestroyed(),this.subComponents.forEach(t=>{t.destroy()}),this.renderedDom){this.renderedDom.elements&&(this.renderedDom.elements=void 0),this.renderedDom.actions&&(this.renderedDom.actions=void 0),this.renderedDom.onDestroy&&this.renderedDom.onDestroy();const t=this.renderingRoot;ne(()=>{var n;if(t)if(t instanceof DocumentFragment)for(;t.firstChild;)t.removeChild(t.firstChild);else e?(n=t.parentElement)==null||n.removeChild(t):De(t)}),this.renderedDom=null,this.renderingRoot=null}this.__destroyed=!0,this.__context=null,this.props=void 0,this.elementProps.clear(),this.rendererEventListeners.clear(),this.subComponents.clear()}getSubComponentPortal(e){var o;const t=this.subComponents.get(e),n=this.subComponentElementIds.get(e);if(!t||!n)return null;const s=((o=this.renderedDom)==null?void 0:o.elements)[n];return s instanceof HTMLElement?s:null}mountSubComponentToPortal(e,t){const n=this.subComponents.get(e);n==null||n.render(t)}schedulePropUpdate(e,t,n){var a;if(!this.renderedDom||!((a=this.def)!=null&&a.update))return;const s=this.renderedDom,o=this.renderingRoot,i=this.def.update;o&&ne(()=>{i({propName:e,currentValue:t,newValue:n,dom:{root:o,elements:s.elements,actions:s.actions},updateSubComponent:this.updateSubComponent})})}}J.__compEventListeners=null,J.__compId=null,J.__renderer=null,J.__updater=null;const pe=(r,e,t)=>n=>{n.__compId=r,n.__renderer=e,n.__updater=t},V=r=>(e,t)=>{const n=e;if(typeof n.constructor!="function")throw new he({source:"CallbackFor",message:"@CallbackFor can only be used on methods of a class!"});n.constructor.hasOwnProperty("__compEventListeners")&&n.constructor.__compEventListeners!==null||(n.constructor.__compEventListeners=new Map);const s=n.constructor.__compEventListeners,o=s.get(r);o?o.push(t):s.set(r,[t])};function zs(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}let ke={async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null};function an(r){ke=r}var Ds=Object.defineProperty,Jn=(r,e,t)=>((n,s,o)=>s in n?Ds(n,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[s]=o)(r,typeof e!="symbol"?e+"":e,t);let Te=class{constructor(e){Jn(this,"options"),this.options=e||ke}postprocess(e){return e}preprocess(e){return e}processAllTokens(e){return e}};Jn(Te,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"]));const Kn=/[&<>"']/,Hs=new RegExp(Kn.source,"g"),Gn=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,js=new RegExp(Gn.source,"g"),qs={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ln=r=>qs[r];function Z(r,e){if(e){if(Kn.test(r))return r.replace(Hs,ln)}else if(Gn.test(r))return r.replace(js,ln);return r}const Ns=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi;function Qs(r){return r.replace(Ns,(e,t)=>(t=t.toLowerCase())==="colon"?":":t.charAt(0)==="#"?t.charAt(1)==="x"?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):"")}const $s=/(^|[^\[])\^/g;function L(r,e){let t=typeof r=="string"?r:r.source;e=e||"";const n={replace:(s,o)=>{let i=typeof o=="string"?o:o.source;return i=i.replace($s,"$1"),t=t.replace(s,i),n},getRegex:()=>new RegExp(t,e)};return n}function cn(r){try{r=encodeURI(r).replace(/%25/g,"%")}catch{return null}return r}const Le={exec:()=>null};function un(r,e){const t=r.replace(/\|/g,(s,o,i)=>{let a=!1,p=o;for(;--p>=0&&i[p]==="\\";)a=!a;return a?"|":" |"}).split(/ \|/);let n=0;if(t[0].trim()||t.shift(),t.length>0&&!t[t.length-1].trim()&&t.pop(),e)if(t.length>e)t.splice(e);else for(;t.length<e;)t.push("");for(;n<t.length;n++)t[n]=t[n].trim().replace(/\\\|/g,"|");return t}function Ye(r,e,t){const n=r.length;if(n===0)return"";let s=0;for(;s<n;){const o=r.charAt(n-s-1);if(o!==e||t){if(o===e||!t)break;s++}else s++}return r.slice(0,n-s)}const He=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Vn=/(?:[*+-]|\d{1,9}[.)])/,_n=L(/^(?!bull |blockCode|fences|blockquote|heading|html)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html))+?)\n {0,3}(=+|-+) *(?:\n+|$)/).replace(/bull/g,Vn).replace(/blockCode/g,/ {4}/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).getRegex(),Ut=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Yt=/(?!\s*\])(?:\\.|[^\[\]\\])+/,Us=L(/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/).replace("label",Yt).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),Ys=L(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,Vn).getRegex(),gt="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Ft=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,Fs=L("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))","i").replace("comment",Ft).replace("tag",gt).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),pn=L(Ut).replace("hr",He).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",gt).getRegex(),Xt={blockquote:L(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",pn).getRegex(),code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,def:Us,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,hr:He,html:Fs,lheading:_n,list:Ys,newline:/^(?: *(?:\n|$))+/,paragraph:pn,table:Le,text:/^[^\n]+/},dn=L("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",He).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",gt).getRegex(),Xs={...Xt,table:dn,paragraph:L(Ut).replace("hr",He).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",dn).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",gt).getRegex()},Zs={...Xt,html:L(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Ft).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Le,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:L(Ut).replace("hr",He).replace("heading",` *#{1,6} *[^
]`).replace("lheading",_n).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},es=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,ts=/^( {2,}|\\)\n(?!\s*$)/,je="\\p{P}\\p{S}",Ws=L(/^((?![*_])[\spunctuation])/,"u").replace(/punctuation/g,je).getRegex(),Js=L(/^(?:\*+(?:((?!\*)[punct])|[^\s*]))|^_+(?:((?!_)[punct])|([^\s_]))/,"u").replace(/punct/g,je).getRegex(),Ks=L("^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)[punct](\\*+)(?=[\\s]|$)|[^punct\\s](\\*+)(?!\\*)(?=[punct\\s]|$)|(?!\\*)[punct\\s](\\*+)(?=[^punct\\s])|[\\s](\\*+)(?!\\*)(?=[punct])|(?!\\*)[punct](\\*+)(?!\\*)(?=[punct])|[^punct\\s](\\*+)(?=[^punct\\s])","gu").replace(/punct/g,je).getRegex(),Gs=L("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)[punct](_+)(?=[\\s]|$)|[^punct\\s](_+)(?!_)(?=[punct\\s]|$)|(?!_)[punct\\s](_+)(?=[^punct\\s])|[\\s](_+)(?!_)(?=[punct])|(?!_)[punct](_+)(?!_)(?=[punct])","gu").replace(/punct/g,je).getRegex(),Vs=L(/\\([punct])/,"gu").replace(/punct/g,je).getRegex(),_s=L(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),er=L(Ft).replace("(?:-->|$)","-->").getRegex(),tr=L("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",er).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),lt=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,nr=L(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",lt).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),hn=L(/^!?\[(label)\]\[(ref)\]/).replace("label",lt).replace("ref",Yt).getRegex(),mn=L(/^!?\[(ref)\](?:\[\])?/).replace("ref",Yt).getRegex(),Zt={_backpedal:Le,anyPunctuation:Vs,autolink:_s,blockSkip:/\[[^[\]]*?\]\([^\(\)]*?\)|`[^`]*?`|<[^<>]*?>/g,br:ts,code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,del:Le,emStrongLDelim:Js,emStrongRDelimAst:Ks,emStrongRDelimUnd:Gs,escape:es,link:nr,nolink:mn,punctuation:Ws,reflink:hn,reflinkSearch:L("reflink|nolink(?!\\()","g").replace("reflink",hn).replace("nolink",mn).getRegex(),tag:tr,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,url:Le},sr={...Zt,link:L(/^!?\[(label)\]\((.*?)\)/).replace("label",lt).getRegex(),reflink:L(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",lt).getRegex()},At={...Zt,escape:L(es).replace("])","~|])").getRegex(),url:L(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},rr={...At,br:L(ts).replace("{2,}","*").getRegex(),text:L(At.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},Fe={normal:Xt,gfm:Xs,pedantic:Zs},Se={normal:Zt,gfm:At,breaks:rr,pedantic:sr};var or=Object.defineProperty,xt=(r,e,t)=>((n,s,o)=>s in n?or(n,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[s]=o)(r,typeof e!="symbol"?e+"":e,t);function gn(r,e,t,n){const s=e.href,o=e.title?Z(e.title):null,i=r[1].replace(/\\([\[\]])/g,"$1");if(r[0].charAt(0)!=="!"){n.state.inLink=!0;const a={type:"link",raw:t,href:s,title:o,text:i,tokens:n.inlineTokens(i)};return n.state.inLink=!1,a}return{type:"image",raw:t,href:s,title:o,text:Z(i)}}let ct=class{constructor(e){xt(this,"lexer"),xt(this,"options"),xt(this,"rules"),this.options=e||ke}autolink(e){const t=this.rules.inline.autolink.exec(e);if(t){let n,s;return t[2]==="@"?(n=Z(t[1]),s="mailto:"+n):(n=Z(t[1]),s=n),{type:"link",raw:t[0],text:n,href:s,tokens:[{type:"text",raw:n,text:n}]}}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){let n=t[0].replace(/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,`
    $1`);n=Ye(n.replace(/^ *>[ \t]?/gm,""),`
`);const s=this.lexer.state.top;this.lexer.state.top=!0;const o=this.lexer.blockTokens(n);return this.lexer.state.top=s,{type:"blockquote",raw:t[0],tokens:o,text:n}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const n=t[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?n:Ye(n,`
`)}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let n=t[2].replace(/\n/g," ");const s=/[^ ]/.test(n),o=/^ /.test(n)&&/ $/.test(n);return s&&o&&(n=n.substring(1,n.length-1)),n=Z(n,!0),{type:"codespan",raw:t[0],text:n}}}def(e){const t=this.rules.block.def.exec(e);if(t){const n=t[1].toLowerCase().replace(/\s+/g," "),s=t[2]?t[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",o=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:n,raw:t[0],href:s,title:o}}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}emStrong(e,t,n=""){let s=this.rules.inline.emStrongLDelim.exec(e);if(s&&!(s[3]&&n.match(/[\p{L}\p{N}]/u))&&(!(s[1]||s[2])||!n||this.rules.inline.punctuation.exec(n))){const o=[...s[0]].length-1;let i,a,p=o,c=0;const l=s[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(l.lastIndex=0,t=t.slice(-1*e.length+o);(s=l.exec(t))!=null;){if(i=s[1]||s[2]||s[3]||s[4]||s[5]||s[6],!i)continue;if(a=[...i].length,s[3]||s[4]){p+=a;continue}if((s[5]||s[6])&&o%3&&!((o+a)%3)){c+=a;continue}if(p-=a,p>0)continue;a=Math.min(a,a+p+c);const h=[...s[0]][0].length,u=e.slice(0,o+s.index+h+a);if(Math.min(o,a)%2){const d=u.slice(1,-1);return{type:"em",raw:u,text:d,tokens:this.lexer.inlineTokens(d)}}const g=u.slice(2,-2);return{type:"strong",raw:u,text:g,tokens:this.lexer.inlineTokens(g)}}}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:Z(t[1])}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const n=t[0],s=function(o,i){const a=o.match(/^(\s+)(?:```)/);if(a===null)return i;const p=a[1];return i.split(`
`).map(c=>{const l=c.match(/^\s+/);if(l===null)return c;const[h]=l;return h.length>=p.length?c.slice(p.length):c}).join(`
`)}(n,t[3]||"");return{type:"code",raw:n,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:s}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let n=t[2].trim();if(/#$/.test(n)){const s=Ye(n,"#");this.options.pedantic?n=s.trim():s&&!/ $/.test(s)||(n=s.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:t[0]}}html(e){const t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}inlineText(e){const t=this.rules.inline.text.exec(e);if(t){let n;return n=this.lexer.state.inRawBlock?t[0]:Z(t[0]),{type:"text",raw:t[0],text:n}}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}link(e){const t=this.rules.inline.link.exec(e);if(t){const n=t[2].trim();if(!this.options.pedantic&&/^</.test(n)){if(!/>$/.test(n))return;const i=Ye(n.slice(0,-1),"\\");if((n.length-i.length)%2==0)return}else{const i=function(a,p){if(a.indexOf(p[1])===-1)return-1;let c=0;for(let l=0;l<a.length;l++)if(a[l]==="\\")l++;else if(a[l]===p[0])c++;else if(a[l]===p[1]&&(c--,c<0))return l;return-1}(t[2],"()");if(i>-1){const a=(t[0].indexOf("!")===0?5:4)+t[1].length+i;t[2]=t[2].substring(0,i),t[0]=t[0].substring(0,a).trim(),t[3]=""}}let s=t[2],o="";if(this.options.pedantic){const i=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(s);i&&(s=i[1],o=i[3])}else o=t[3]?t[3].slice(1,-1):"";return s=s.trim(),/^</.test(s)&&(s=this.options.pedantic&&!/>$/.test(n)?s.slice(1):s.slice(1,-1)),gn(t,{href:s&&s.replace(this.rules.inline.anyPunctuation,"$1"),title:o&&o.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer)}}list(e){let t=this.rules.block.list.exec(e);if(t){let n=t[1].trim();const s=n.length>1,o={type:"list",raw:"",ordered:s,start:s?+n.slice(0,-1):"",loose:!1,items:[]};n=s?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=s?n:"[*+-]");const i=new RegExp(`^( {0,3}${n})((?:[	 ][^\\n]*)?(?:\\n|$))`);let a="",p="",c=!1;for(;e;){let l=!1;if(!(t=i.exec(e))||this.rules.block.hr.test(e))break;a=t[0],e=e.substring(a.length);let h=t[2].split(`
`,1)[0].replace(/^\t+/,w=>" ".repeat(3*w.length)),u=e.split(`
`,1)[0],g=0;this.options.pedantic?(g=2,p=h.trimStart()):(g=t[2].search(/[^ ]/),g=g>4?1:g,p=h.slice(g),g+=t[1].length);let d=!1;if(!h&&/^ *$/.test(u)&&(a+=u+`
`,e=e.substring(u.length+1),l=!0),!l){const w=new RegExp(`^ {0,${Math.min(3,g-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),x=new RegExp(`^ {0,${Math.min(3,g-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),y=new RegExp(`^ {0,${Math.min(3,g-1)}}(?:\`\`\`|~~~)`),S=new RegExp(`^ {0,${Math.min(3,g-1)}}#`);for(;e;){const v=e.split(`
`,1)[0];if(u=v,this.options.pedantic&&(u=u.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),y.test(u)||S.test(u)||w.test(u)||x.test(e))break;if(u.search(/[^ ]/)>=g||!u.trim())p+=`
`+u.slice(g);else{if(d||h.search(/[^ ]/)>=4||y.test(h)||S.test(h)||x.test(h))break;p+=`
`+u}d||u.trim()||(d=!0),a+=v+`
`,e=e.substring(v.length+1),h=u.slice(g)}}o.loose||(c?o.loose=!0:/\n *\n *$/.test(a)&&(c=!0));let m,f=null;this.options.gfm&&(f=/^\[[ xX]\] /.exec(p),f&&(m=f[0]!=="[ ] ",p=p.replace(/^\[[ xX]\] +/,""))),o.items.push({type:"list_item",raw:a,task:!!f,checked:m,loose:!1,text:p,tokens:[]}),o.raw+=a}o.items[o.items.length-1].raw=a.trimEnd(),o.items[o.items.length-1].text=p.trimEnd(),o.raw=o.raw.trimEnd();for(let l=0;l<o.items.length;l++)if(this.lexer.state.top=!1,o.items[l].tokens=this.lexer.blockTokens(o.items[l].text,[]),!o.loose){const h=o.items[l].tokens.filter(g=>g.type==="space"),u=h.length>0&&h.some(g=>/\n.*\n/.test(g.raw));o.loose=u}if(o.loose)for(let l=0;l<o.items.length;l++)o.items[l].loose=!0;return o}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const n=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:n,tokens:this.lexer.inline(n)}}}reflink(e,t){let n;if((n=this.rules.inline.reflink.exec(e))||(n=this.rules.inline.nolink.exec(e))){const s=t[(n[2]||n[1]).replace(/\s+/g," ").toLowerCase()];if(!s){const o=n[0].charAt(0);return{type:"text",raw:o,text:o}}return gn(n,s,n[0],this.lexer)}}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}table(e){const t=this.rules.block.table.exec(e);if(!t||!/[:|]/.test(t[2]))return;const n=un(t[1]),s=t[2].replace(/^\||\| *$/g,"").split("|"),o=t[3]&&t[3].trim()?t[3].replace(/\n[ \t]*$/,"").split(`
`):[],i={type:"table",raw:t[0],header:[],align:[],rows:[]};if(n.length===s.length){for(const a of s)/^ *-+: *$/.test(a)?i.align.push("right"):/^ *:-+: *$/.test(a)?i.align.push("center"):/^ *:-+ *$/.test(a)?i.align.push("left"):i.align.push(null);for(const a of n)i.header.push({text:a,tokens:this.lexer.inline(a)});for(const a of o)i.rows.push(un(a,i.header.length).map(p=>({text:p,tokens:this.lexer.inline(p)})));return i}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&/^<a /i.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}url(e){var n;let t;if(t=this.rules.inline.url.exec(e)){let s,o;if(t[2]==="@")s=Z(t[0]),o="mailto:"+s;else{let i;do i=t[0],t[0]=((n=this.rules.inline._backpedal.exec(t[0]))==null?void 0:n[0])??"";while(i!==t[0]);s=Z(t[0]),o=t[1]==="www."?"http://"+t[0]:t[0]}return{type:"link",raw:t[0],text:s,href:o,tokens:[{type:"text",raw:s,text:s}]}}}};var ir=Object.defineProperty,Ae=(r,e,t)=>((n,s,o)=>s in n?ir(n,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[s]=o)(r,typeof e!="symbol"?e+"":e,t);let ye=class It{constructor(e){Ae(this,"options"),Ae(this,"state"),Ae(this,"tokens"),Ae(this,"inlineQueue"),Ae(this,"tokenizer"),this.tokens=[],this.tokens.links=Object.create(null),this.options=e||ke,this.options.tokenizer=this.options.tokenizer||new ct,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={block:Fe.normal,inline:Se.normal};this.options.pedantic?(t.block=Fe.pedantic,t.inline=Se.pedantic):this.options.gfm&&(t.block=Fe.gfm,this.options.breaks?t.inline=Se.breaks:t.inline=Se.gfm),this.tokenizer.rules=t}static get rules(){return{block:Fe,inline:Se}}static lex(e,t){return new It(t).lex(e)}static lexInline(e,t){return new It(t).inlineTokens(e)}blockTokens(e,t=[]){let n,s,o,i;for(e=this.options.pedantic?e.replace(/\t/g,"    ").replace(/^ +$/gm,""):e.replace(/^( *)(\t+)/gm,(a,p,c)=>p+"    ".repeat(c.length));e;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(a=>!!(n=a.call({lexer:this},e,t))&&(e=e.substring(n.raw.length),t.push(n),!0))))if(n=this.tokenizer.space(e))e=e.substring(n.raw.length),n.raw.length===1&&t.length>0?t[t.length-1].raw+=`
`:t.push(n);else if(n=this.tokenizer.code(e))e=e.substring(n.raw.length),s=t[t.length-1],!s||s.type!=="paragraph"&&s.type!=="text"?t.push(n):(s.raw+=`
`+n.raw,s.text+=`
`+n.text,this.inlineQueue[this.inlineQueue.length-1].src=s.text);else if(n=this.tokenizer.fences(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.heading(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.hr(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.blockquote(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.list(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.html(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.def(e))e=e.substring(n.raw.length),s=t[t.length-1],!s||s.type!=="paragraph"&&s.type!=="text"?this.tokens.links[n.tag]||(this.tokens.links[n.tag]={href:n.href,title:n.title}):(s.raw+=`
`+n.raw,s.text+=`
`+n.raw,this.inlineQueue[this.inlineQueue.length-1].src=s.text);else if(n=this.tokenizer.table(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.lheading(e))e=e.substring(n.raw.length),t.push(n);else{if(o=e,this.options.extensions&&this.options.extensions.startBlock){let a=1/0;const p=e.slice(1);let c;this.options.extensions.startBlock.forEach(l=>{c=l.call({lexer:this},p),typeof c=="number"&&c>=0&&(a=Math.min(a,c))}),a<1/0&&a>=0&&(o=e.substring(0,a+1))}if(this.state.top&&(n=this.tokenizer.paragraph(o)))s=t[t.length-1],i&&s.type==="paragraph"?(s.raw+=`
`+n.raw,s.text+=`
`+n.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=s.text):t.push(n),i=o.length!==e.length,e=e.substring(n.raw.length);else if(n=this.tokenizer.text(e))e=e.substring(n.raw.length),s=t[t.length-1],s&&s.type==="text"?(s.raw+=`
`+n.raw,s.text+=`
`+n.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=s.text):t.push(n);else if(e){const a="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(a);break}throw new Error(a)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let n,s,o,i,a,p,c=e;if(this.tokens.links){const l=Object.keys(this.tokens.links);if(l.length>0)for(;(i=this.tokenizer.rules.inline.reflinkSearch.exec(c))!=null;)l.includes(i[0].slice(i[0].lastIndexOf("[")+1,-1))&&(c=c.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+c.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(i=this.tokenizer.rules.inline.blockSkip.exec(c))!=null;)c=c.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+c.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(i=this.tokenizer.rules.inline.anyPunctuation.exec(c))!=null;)c=c.slice(0,i.index)+"++"+c.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;e;)if(a||(p=""),a=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(l=>!!(n=l.call({lexer:this},e,t))&&(e=e.substring(n.raw.length),t.push(n),!0))))if(n=this.tokenizer.escape(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.tag(e))e=e.substring(n.raw.length),s=t[t.length-1],s&&n.type==="text"&&s.type==="text"?(s.raw+=n.raw,s.text+=n.text):t.push(n);else if(n=this.tokenizer.link(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.reflink(e,this.tokens.links))e=e.substring(n.raw.length),s=t[t.length-1],s&&n.type==="text"&&s.type==="text"?(s.raw+=n.raw,s.text+=n.text):t.push(n);else if(n=this.tokenizer.emStrong(e,c,p))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.codespan(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.br(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.del(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.autolink(e))e=e.substring(n.raw.length),t.push(n);else if(this.state.inLink||!(n=this.tokenizer.url(e))){if(o=e,this.options.extensions&&this.options.extensions.startInline){let l=1/0;const h=e.slice(1);let u;this.options.extensions.startInline.forEach(g=>{u=g.call({lexer:this},h),typeof u=="number"&&u>=0&&(l=Math.min(l,u))}),l<1/0&&l>=0&&(o=e.substring(0,l+1))}if(n=this.tokenizer.inlineText(o))e=e.substring(n.raw.length),n.raw.slice(-1)!=="_"&&(p=n.raw.slice(-1)),a=!0,s=t[t.length-1],s&&s.type==="text"?(s.raw+=n.raw,s.text+=n.text):t.push(n);else if(e){const l="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(l);break}throw new Error(l)}}else e=e.substring(n.raw.length),t.push(n);return t}lex(e){e=e.replace(/\r\n|\r/g,`
`),this.blockTokens(e,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){const n=this.inlineQueue[t];this.inlineTokens(n.src,n.tokens)}return this.inlineQueue=[],this.tokens}};var ar=Object.defineProperty,lr=(r,e,t)=>((n,s,o)=>s in n?ar(n,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[s]=o)(r,e+"",t);let ut=class{constructor(e){lr(this,"options"),this.options=e||ke}blockquote(e){return`<blockquote>
${e}</blockquote>
`}br(){return"<br>"}checkbox(e){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}code(e,t,n){var o;const s=(o=(t||"").match(/^\S*/))==null?void 0:o[0];return e=e.replace(/\n$/,"")+`
`,s?'<pre><code class="language-'+Z(s)+'">'+(n?e:Z(e,!0))+`</code></pre>
`:"<pre><code>"+(n?e:Z(e,!0))+`</code></pre>
`}codespan(e){return`<code>${e}</code>`}del(e){return`<del>${e}</del>`}em(e){return`<em>${e}</em>`}heading(e,t,n){return`<h${t}>${e}</h${t}>
`}hr(){return`<hr>
`}html(e,t){return e}image(e,t,n){const s=cn(e);if(s===null)return n;let o=`<img src="${e=s}" alt="${n}"`;return t&&(o+=` title="${t}"`),o+=">",o}link(e,t,n){const s=cn(e);if(s===null)return n;let o='<a href="'+(e=s)+'"';return t&&(o+=' title="'+t+'"'),o+=">"+n+"</a>",o}list(e,t,n){const s=t?"ol":"ul";return"<"+s+(t&&n!==1?' start="'+n+'"':"")+`>
`+e+"</"+s+`>
`}listitem(e,t,n){return`<li>${e}</li>
`}paragraph(e){return`<p>${e}</p>
`}strong(e){return`<strong>${e}</strong>`}table(e,t){return t&&(t=`<tbody>${t}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+t+`</table>
`}tablecell(e,t){const n=t.header?"th":"td";return(t.align?`<${n} align="${t.align}">`:`<${n}>`)+e+`</${n}>
`}tablerow(e){return`<tr>
${e}</tr>
`}text(e){return e}},Wt=class{strong(e){return e}em(e){return e}codespan(e){return e}del(e){return e}html(e){return e}text(e){return e}link(e,t,n){return""+n}image(e,t,n){return""+n}br(){return""}};var cr=Object.defineProperty,wt=(r,e,t)=>((n,s,o)=>s in n?cr(n,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[s]=o)(r,typeof e!="symbol"?e+"":e,t);let ve=class Et{constructor(e){wt(this,"options"),wt(this,"renderer"),wt(this,"textRenderer"),this.options=e||ke,this.options.renderer=this.options.renderer||new ut,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new Wt}static parse(e,t){return new Et(t).parse(e)}static parseInline(e,t){return new Et(t).parseInline(e)}parse(e,t=!0){let n="";for(let s=0;s<e.length;s++){const o=e[s];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[o.type]){const i=o,a=this.options.extensions.renderers[i.type].call({parser:this},i);if(a!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(i.type)){n+=a||"";continue}}switch(o.type){case"space":continue;case"hr":n+=this.renderer.hr();continue;case"heading":{const i=o;n+=this.renderer.heading(this.parseInline(i.tokens),i.depth,Qs(this.parseInline(i.tokens,this.textRenderer)));continue}case"code":{const i=o;n+=this.renderer.code(i.text,i.lang,!!i.escaped);continue}case"table":{const i=o;let a="",p="";for(let l=0;l<i.header.length;l++)p+=this.renderer.tablecell(this.parseInline(i.header[l].tokens),{header:!0,align:i.align[l]});a+=this.renderer.tablerow(p);let c="";for(let l=0;l<i.rows.length;l++){const h=i.rows[l];p="";for(let u=0;u<h.length;u++)p+=this.renderer.tablecell(this.parseInline(h[u].tokens),{header:!1,align:i.align[u]});c+=this.renderer.tablerow(p)}n+=this.renderer.table(a,c);continue}case"blockquote":{const i=o,a=this.parse(i.tokens);n+=this.renderer.blockquote(a);continue}case"list":{const i=o,a=i.ordered,p=i.start,c=i.loose;let l="";for(let h=0;h<i.items.length;h++){const u=i.items[h],g=u.checked,d=u.task;let m="";if(u.task){const f=this.renderer.checkbox(!!g);c?u.tokens.length>0&&u.tokens[0].type==="paragraph"?(u.tokens[0].text=f+" "+u.tokens[0].text,u.tokens[0].tokens&&u.tokens[0].tokens.length>0&&u.tokens[0].tokens[0].type==="text"&&(u.tokens[0].tokens[0].text=f+" "+u.tokens[0].tokens[0].text)):u.tokens.unshift({type:"text",text:f+" "}):m+=f+" "}m+=this.parse(u.tokens,c),l+=this.renderer.listitem(m,d,!!g)}n+=this.renderer.list(l,a,p);continue}case"html":{const i=o;n+=this.renderer.html(i.text,i.block);continue}case"paragraph":{const i=o;n+=this.renderer.paragraph(this.parseInline(i.tokens));continue}case"text":{let i=o,a=i.tokens?this.parseInline(i.tokens):i.text;for(;s+1<e.length&&e[s+1].type==="text";)i=e[++s],a+=`
`+(i.tokens?this.parseInline(i.tokens):i.text);n+=t?this.renderer.paragraph(a):a;continue}default:{const i='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(i),"";throw new Error(i)}}}return n}parseInline(e,t){t=t||this.renderer;let n="";for(let s=0;s<e.length;s++){const o=e[s];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[o.type]){const i=this.options.extensions.renderers[o.type].call({parser:this},o);if(i!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(o.type)){n+=i||"";continue}}switch(o.type){case"escape":{const i=o;n+=t.text(i.text);break}case"html":{const i=o;n+=t.html(i.text);break}case"link":{const i=o;n+=t.link(i.href,i.title,this.parseInline(i.tokens,t));break}case"image":{const i=o;n+=t.image(i.href,i.title,i.text);break}case"strong":{const i=o;n+=t.strong(this.parseInline(i.tokens,t));break}case"em":{const i=o;n+=t.em(this.parseInline(i.tokens,t));break}case"codespan":{const i=o;n+=t.codespan(i.text);break}case"br":n+=t.br();break;case"del":{const i=o;n+=t.del(this.parseInline(i.tokens,t));break}case"text":{const i=o;n+=t.text(i.text);break}default:{const i='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(i),"";throw new Error(i)}}}return n}};var Re,fn,Pt,ur=Object.defineProperty,ns=r=>{throw TypeError(r)},ee=(r,e,t)=>((n,s,o)=>s in n?ur(n,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[s]=o)(r,typeof e!="symbol"?e+"":e,t),Bt=(r,e,t)=>(((n,s,o)=>{s.has(n)||ns("Cannot "+o)})(r,e,"access private method"),t);Re=new WeakSet,fn=function(r,e){return t=>{if(t.message+=`
Please report this to https://github.com/markedjs/marked.`,r){const n="<p>An error occurred:</p><pre>"+Z(t.message+"",!0)+"</pre>";return e?Promise.resolve(n):n}if(e)return Promise.reject(t);throw t}},Pt=function(r,e){return(t,n)=>{const s={...n},o={...this.defaults,...s};this.defaults.async===!0&&s.async===!1&&(o.silent||console.warn("marked(): The async option was set to true by an extension. The async: false option sent to parse will be ignored."),o.async=!0);const i=Bt(this,Re,fn).call(this,!!o.silent,!!o.async);if(t==null)return i(new Error("marked(): input parameter is undefined or null"));if(typeof t!="string")return i(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));if(o.hooks&&(o.hooks.options=o),o.async)return Promise.resolve(o.hooks?o.hooks.preprocess(t):t).then(a=>r(a,o)).then(a=>o.hooks?o.hooks.processAllTokens(a):a).then(a=>o.walkTokens?Promise.all(this.walkTokens(a,o.walkTokens)).then(()=>a):a).then(a=>e(a,o)).then(a=>o.hooks?o.hooks.postprocess(a):a).catch(i);try{o.hooks&&(t=o.hooks.preprocess(t));let a=r(t,o);o.hooks&&(a=o.hooks.processAllTokens(a)),o.walkTokens&&this.walkTokens(a,o.walkTokens);let p=e(a,o);return o.hooks&&(p=o.hooks.postprocess(p)),p}catch(a){return i(a)}}};const me=new class{constructor(...r){var e,t,n;e=this,(t=Re).has(e)?ns("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),ee(this,"Hooks",Te),ee(this,"Lexer",ye),ee(this,"Parser",ve),ee(this,"Renderer",ut),ee(this,"TextRenderer",Wt),ee(this,"Tokenizer",ct),ee(this,"defaults",{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}),ee(this,"options",this.setOptions),ee(this,"parse",Bt(this,Re,Pt).call(this,ye.lex,ve.parse)),ee(this,"parseInline",Bt(this,Re,Pt).call(this,ye.lexInline,ve.parseInline)),this.use(...r)}lexer(r,e){return ye.lex(r,e??this.defaults)}parser(r,e){return ve.parse(r,e??this.defaults)}setOptions(r){return this.defaults={...this.defaults,...r},this}use(...r){const e=this.defaults.extensions||{renderers:{},childTokens:{}};return r.forEach(t=>{const n={...t};if(n.async=this.defaults.async||n.async||!1,t.extensions&&(t.extensions.forEach(s=>{if(!s.name)throw new Error("extension name required");if("renderer"in s){const o=e.renderers[s.name];e.renderers[s.name]=o?function(...i){let a=s.renderer.apply(this,i);return a===!1&&(a=o.apply(this,i)),a}:s.renderer}if("tokenizer"in s){if(!s.level||s.level!=="block"&&s.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");const o=e[s.level];o?o.unshift(s.tokenizer):e[s.level]=[s.tokenizer],s.start&&(s.level==="block"?e.startBlock?e.startBlock.push(s.start):e.startBlock=[s.start]:s.level==="inline"&&(e.startInline?e.startInline.push(s.start):e.startInline=[s.start]))}"childTokens"in s&&s.childTokens&&(e.childTokens[s.name]=s.childTokens)}),n.extensions=e),t.renderer){const s=this.defaults.renderer||new ut(this.defaults);for(const o in t.renderer){if(!(o in s))throw new Error(`renderer '${o}' does not exist`);if(o==="options")continue;const i=o,a=t.renderer[i],p=s[i];s[i]=(...c)=>{let l=a.apply(s,c);return l===!1&&(l=p.apply(s,c)),l||""}}n.renderer=s}if(t.tokenizer){const s=this.defaults.tokenizer||new ct(this.defaults);for(const o in t.tokenizer){if(!(o in s))throw new Error(`tokenizer '${o}' does not exist`);if(["options","rules","lexer"].includes(o))continue;const i=o,a=t.tokenizer[i],p=s[i];s[i]=(...c)=>{let l=a.apply(s,c);return l===!1&&(l=p.apply(s,c)),l}}n.tokenizer=s}if(t.hooks){const s=this.defaults.hooks||new Te;for(const o in t.hooks){if(!(o in s))throw new Error(`hook '${o}' does not exist`);if(o==="options")continue;const i=o,a=t.hooks[i],p=s[i];Te.passThroughHooks.has(o)?s[i]=c=>{if(this.defaults.async)return Promise.resolve(a.call(s,c)).then(h=>p.call(s,h));const l=a.call(s,c);return p.call(s,l)}:s[i]=(...c)=>{let l=a.apply(s,c);return l===!1&&(l=p.apply(s,c)),l}}n.hooks=s}if(t.walkTokens){const s=this.defaults.walkTokens,o=t.walkTokens;n.walkTokens=function(i){let a=[];return a.push(o.call(this,i)),s&&(a=a.concat(s.call(this,i))),a}}this.defaults={...this.defaults,...n}}),this}walkTokens(r,e){var n,s;let t=[];for(const o of r)switch(t=t.concat(e.call(this,o)),o.type){case"table":{const i=o;for(const a of i.header)t=t.concat(this.walkTokens(a.tokens,e));for(const a of i.rows)for(const p of a)t=t.concat(this.walkTokens(p.tokens,e));break}case"list":{const i=o;t=t.concat(this.walkTokens(i.items,e));break}default:{const i=o;(s=(n=this.defaults.extensions)==null?void 0:n.childTokens)!=null&&s[i.type]?this.defaults.extensions.childTokens[i.type].forEach(a=>{const p=i[a].flat(1/0);t=t.concat(this.walkTokens(p,e))}):i.tokens&&(t=t.concat(this.walkTokens(i.tokens,e)))}}return t}};function O(r,e){return me.parse(r,e)}O.options=O.setOptions=function(r){return me.setOptions(r),O.defaults=me.defaults,an(O.defaults),O},O.getDefaults=zs,O.defaults=ke,O.use=function(...r){return me.use(...r),O.defaults=me.defaults,an(O.defaults),O},O.walkTokens=function(r,e){return me.walkTokens(r,e)},O.parseInline=me.parseInline,O.Parser=ve,O.parser=ve.parse,O.Renderer=ut,O.TextRenderer=Wt,O.Lexer=ye,O.lexer=ye.lex,O.Tokenizer=ct,O.Hooks=Te,O.parse=O;const ss=(r,e)=>{const{showCodeBlockCopyButton:t,markdownLinkTarget:n,syntaxHighlighter:s,htmlSanitizer:o}=e||{},i=O(r,{async:!1,breaks:!0});if(typeof i!="string")throw new Error("Markdown parsing failed");const a=document.createElement("div");return a.innerHTML=o?o(i):i,a.querySelectorAll("pre").forEach(p=>{const c=document.createElement("div");c.className="code-block";const l=p.querySelector("code");if(!l){const d=p.innerHTML;return c.innerHTML=o?o(d):d,void p.replaceWith(c)}let h;for(let d=0;d<l.classList.length;d++){const m=l.classList[d];if(m.startsWith("language-")){h=m.slice(9);break}}const u=document.createElement("pre"),g="<div>"+l.innerHTML+"</div>";if(u.innerHTML=e!=null&&e.htmlSanitizer?e.htmlSanitizer(g):g,h&&(u.setAttribute("data-language",h),s)){const d="<div>"+s.createHighlighter()(l.textContent||"",h)+"</div>";u.innerHTML=o?o(d):d,u.className="highlighter-dark"}De(c),c.appendChild(u),p.replaceWith(c)}),t!==!1&&a.querySelectorAll(".code-block").forEach(p=>{var u;if(!p.querySelector("pre")||(u=p.previousElementSibling)!=null&&u.classList.contains("nlux-comp-copyButton"))return;const c="Copy code block to clipboard",l=document.createElement("button");l.classList.add("nlux-comp-copyButton"),l.setAttribute("aria-label",c),l.setAttribute("title",c);const h=document.createElement("span");h.classList.add("icon-copy"),l.appendChild(h),p.insertAdjacentElement("beforebegin",l)}),n!=="self"&&a.querySelectorAll("a").forEach(p=>{p.setAttribute("target","_blank")}),a.innerHTML},kn=r=>{if(!(r instanceof HTMLButtonElement)||r.dataset.clickListenerSet==="true")return;let e=!1;const t=r.nextElementSibling;r.addEventListener("click",()=>{if(e||!t)return;const n=t.innerText;navigator.clipboard.writeText(n??""),e=!0,r.classList.add("clicked"),setTimeout(()=>{e=!1,r.classList.remove("clicked")},1e3)}),r.dataset.clickListenerSet="true"},rs=r=>{const e="nlux-comp-copyButton";r instanceof HTMLButtonElement&&r.classList.contains(e)?kn(r):r.querySelectorAll(`.${e}`).forEach(kn)},pr=(r,e)=>{let t=!1;const{onComplete:n}=e||{},s=[],o=(e!=null&&e.skipStreamingAnimation?"timeout":"animationFrame")=="timeout"?h=>setTimeout(h,0):h=>requestAnimationFrame(h),i=document.createElement("div");i.classList.add("md-in-progress"),r.append(i);const a=()=>{for(;i.firstChild;){const h=i.firstChild;h instanceof HTMLElement&&rs(h),i.before(h)}},p=!(e!=null&&e.skipStreamingAnimation)&&(e!=null&&e.streamingAnimationSpeed)&&e.streamingAnimationSpeed>=0?e.streamingAnimationSpeed:e!=null&&e.skipStreamingAnimation?0:8,c={timeSinceLastProcessing:new Date().getTime(),currentMarkdown:"",previousHtml:void 0};let l=setInterval(()=>{const h=new Date().getTime(),u=(e==null?void 0:e.waitTimeBeforeStreamCompletion)!=="never";if(s.length===0&&u){const d=typeof(e==null?void 0:e.waitTimeBeforeStreamCompletion)=="number"?e.waitTimeBeforeStreamCompletion:2e3;return void((t||h-c.timeSinceLastProcessing>d)&&(t=!0,l&&(clearInterval(l),l=void 0),a(),i.remove(),n==null?void 0:n()))}c.timeSinceLastProcessing=h;const g=s.shift();g&&o(()=>{const d=c.currentMarkdown+g,m=ss(d,e).trim();if(typeof m!="string")return c.currentMarkdown=c.currentMarkdown.slice(0,-g.length),void U("Markdown parsing failed");if(c.previousHtml&&m.length>c.previousHtml.length&&m.startsWith(c.previousHtml)){a();const f=m.slice(c.previousHtml.length).trim();i.innerHTML=e!=null&&e.htmlSanitizer?e.htmlSanitizer(f):f,c.currentMarkdown=g,c.previousHtml=void 0}else i.innerHTML=e!=null&&e.htmlSanitizer?e.htmlSanitizer(m):m,c.currentMarkdown=d,c.previousHtml=m})},p);return{next:h=>{if(t)U("Stream is already complete. No more chunks can be added");else for(const u of h)s.push(u)},complete:()=>{t=!0},error:()=>{t=!0}}},os=(r,e)=>{const t=document.createElement("div");if(t.classList.add("nlux-comp-avatarContainer"),r){const n=document.createElement("div");n.classList.add("nlux-comp-avatarPicture"),n.style.backgroundImage=`url("${encodeURI(r)}")`,t.append(n)}return t},Jt="nlux-comp-avatar",Kt=r=>{const e=document.createElement("div");return e.classList.add(Jt),r.avatar||r.name?(r.name&&(e.title=r.name),r.avatar&&r.avatar instanceof HTMLElement?(e.append(r.avatar.cloneNode(!0)),e):(e.append(os(r.avatar)),e)):e},Xe={received:"nlux_msg_received",sent:"nlux_msg_sent"},is=(r,e)=>{Object.keys(Xe).forEach(t=>{r.classList.remove(Xe[t])}),Xe[e]&&r.classList.add(Xe[e])},Be={streaming:"nlux_msg_streaming",complete:"nlux_msg_complete"},as=(r,e)=>{Object.keys(Be).forEach(t=>{r.classList.remove(Be[t])}),Be[e]&&r.classList.add(Be[e])},ls=(r,e="text",t)=>{if(e==="markdown"){const n=document.createElement("div");n.innerHTML=ss(r,t),rs(n);const s=document.createDocumentFragment();for(;n.firstChild;)s.appendChild(n.firstChild);return s}return document.createTextNode(r)},cs="nlux-comp-message",Ze={received:"nlux-comp-chatItem--received",sent:"nlux-comp-chatItem--sent"},us=(r,e)=>{Object.keys(Ze).forEach(t=>{r.classList.remove(Ze[t])}),Ze[e]&&r.classList.add(Ze[e])},We={bubbles:"nlux-comp-chatItem--bubblesLayout",list:"nlux-comp-chatItem--listLayout"},ps=(r,e)=>{Object.keys(We).forEach(t=>{r.classList.remove(We[t])}),We[e]&&r.classList.add(We[e])},ds="nlux-comp-chatItem-participantInfo",hs="nlux-comp-chatItem-participantName",dr=r=>{const e=document.createElement("div");e.classList.add("nlux-comp-chatItem");const t={direction:r.direction,status:r.status,message:r.message};let n;if(r.avatar!==void 0){const i={name:r.name,avatar:r.avatar};n=Kt(i)}const s=document.createElement("span");s.classList.add(hs),s.textContent=r.name;{const i=document.createElement("div");i.classList.add(ds),n!==void 0&&i.append(n),i.append(s),e.append(i)}us(e,r.direction),ps(e,r.layout);const o=(i=>{const a=document.createElement("div");a.classList.add(cs);const p=i.status?i.status:"complete";return as(a,p),is(a,i.direction),a})(t);return e.append(o),e},xn=(r,e,t)=>{if(e.name!==t.name&&typeof t.avatar=="string"){const n=t.name&&t.name.length>0?t.name[0].toUpperCase():"",s=r.querySelector("* > .nlux-comp-avatarContainer > .avtr_ltr");s==null||s.replaceChildren(n)}},ms=(r,e,t)=>{e.avatar===t.avatar&&e.name===t.name||(e.avatar!==t.avatar&&((n,s,o)=>{if(s.avatar!==o.avatar)if(typeof o.avatar=="string"&&typeof s.avatar=="string"){const i=n.querySelector("* > .nlux-comp-avatarContainer > .nlux-comp-avatarPicture");i!==null&&(i.style.backgroundImage=`url("${encodeURI(o.avatar)}")`)}else if(typeof o.avatar=="string"){const i=os(o.avatar);n.replaceChildren(i)}else o.avatar?n.replaceChildren(o.avatar.cloneNode(!0)):De(n)})(r,e,t),t.name?e.name!==t.name&&(r.title=t.name,xn(r,e,t)):(r.title="",xn(r,e,t)))},hr=(r,e,t)=>{if(e.message===t.message&&e.status===t.status&&e.direction===t.direction||!t||!t.hasOwnProperty("message")&&!t.hasOwnProperty("status")&&!t.hasOwnProperty("direction"))return;e.direction!==t.direction&&is(r,t.direction);const n=t.status;if(e.status!==n)return as(r,t.status),void((s,o,i)=>{const a=i.status;if(a!=="streaming"&&a==="complete"){const p=i.message?i.message:"",c=document.createTextNode(p);s.classList.add(Be[a]),De(s),s.append(c)}})(r,0,t);n==="complete"&&(e.message===t.message&&e.format===t.format||((s,o,i)=>{o.message===i.message&&o.format===i.format||(De(s),s.append(ls(i.message??"",i.format)))})(r,e,t))},wn="dom/getElement";var mr=Object.defineProperty,gr=Object.getOwnPropertyDescriptor,bn=(r,e,t,n)=>{for(var s,o=n>1?void 0:n?gr(e,t):e,i=r.length-1;i>=0;i--)(s=r[i])&&(o=(n?s(e,t,o):s(o))||o);return n&&o&&mr(e,t,o),o};let ot=class extends J{constructor(e,t){super(e,t),this.serverResponse=[],this.stringContent="",t.domProps.message!==void 0&&(this.stringContent=t.domProps.message)}addChunk(e,t){this.throwIfDestroyed(),this.executeDomAction("processStreamedChunk",e),typeof e=="string"&&(this.stringContent+=e),this.serverResponse.push(t)}commitChunks(){this.throwIfDestroyed(),this.executeDomAction("commitStreamedChunks")}getChatSegmentItem(){return this.getProp("domProps").direction==="received"?{uid:this.props.uid,participantRole:"assistant",content:this.getItemContent(),serverResponse:this.serverResponse,status:"complete",dataTransferMode:"batch",time:new Date}:{uid:this.props.uid,participantRole:"user",content:this.getItemContent(),status:"complete",time:new Date}}getItemContent(){return this.aiMessageContent??this.stringContent}updateDomProps(e){const t=this.getProp("domProps"),n={...t,...e};this.setProp("domProps",n),this.executeDomAction("updateDomProps",t,n)}updateMarkdownStreamRenderer(e,t){if(this.setProp(e,t),e==="syntaxHighlighter"){const n=t;this.executeDomAction("updateMarkdownStreamRenderer",{syntaxHighlighter:n})}if(e==="htmlSanitizer"){const n=t;this.executeDomAction("updateMarkdownStreamRenderer",{htmlSanitizer:n})}}onMarkdownStreamComplete(e){this.context.emit("messageRendered",{uid:this.props.uid,message:e})}};bn([V("markdown-stream-complete")],ot.prototype,"onMarkdownStreamComplete",1),ot=bn([pe("chatItem",({props:r,appendToRoot:e,compEvent:t})=>{const n=dr({...r.domProps,message:void 0}),s=((l,h)=>{const u=l.querySelector(h);if(!u)throw new at({source:wn,message:`Could not find element with query "${h}". Make sure the query provided matches an element that exists in the root element.`});if(!(u instanceof HTMLElement))throw new at({source:wn,message:`Element with query "${h}" is not a valid HTMLElement.`});return u})(n,".nlux-comp-message");if(!s)throw new Error("Message container not found");const o=document.createElement("div");o.classList.add("nlux-markdownStream-root");const i=document.createElement("div");if(i.classList.add("nlux-markdown-container"),i.setAttribute("nlux-message-id",r.uid),o.append(i),s.append(o),r.domProps.message){const l=ls(r.domProps.message??"","markdown",{markdownLinkTarget:r.markdownLinkTarget,syntaxHighlighter:r.syntaxHighlighter,htmlSanitizer:r.htmlSanitizer});i.append(l)}let a;e(n);let p={...r};const c=l=>((h,u)=>{const g=pr(h,{syntaxHighlighter:u==null?void 0:u.syntaxHighlighter,htmlSanitizer:u==null?void 0:u.htmlSanitizer,markdownLinkTarget:u==null?void 0:u.markdownLinkTarget,showCodeBlockCopyButton:u==null?void 0:u.showCodeBlockCopyButton,skipStreamingAnimation:u==null?void 0:u.skipStreamingAnimation,streamingAnimationSpeed:u==null?void 0:u.streamingAnimationSpeed,waitTimeBeforeStreamCompletion:u==null?void 0:u.waitTimeBeforeStreamCompletion,onComplete:u==null?void 0:u.onComplete});return{next(d){g.next(d)},complete(){g.complete()}}})(i,{syntaxHighlighter:l.syntaxHighlighter,htmlSanitizer:l.htmlSanitizer,markdownLinkTarget:l.markdownLinkTarget,showCodeBlockCopyButton:l.showCodeBlockCopyButton,skipStreamingAnimation:l.skipStreamingAnimation,streamingAnimationSpeed:l.streamingAnimationSpeed,onComplete:()=>t("markdown-stream-complete")});return{elements:{chatItemContainer:n},actions:{focus:()=>{n.focus()},processStreamedChunk:l=>{a||(a=c(p)),a.next(l)},commitStreamedChunks:()=>{a&&a.complete()},updateMarkdownStreamRenderer:l=>{p={...p,...l},c(p)},updateDomProps:(l,h)=>{((u,g,d)=>{if((g.direction!==d.direction||g.layout!==d.layout||g.status!==d.status||g.message!==d.message||g.name!==d.name||g.avatar!==d.avatar)&&d&&(d.hasOwnProperty("direction")||d.hasOwnProperty("layout")||d.hasOwnProperty("status")||d.hasOwnProperty("message")||d.hasOwnProperty("loader")||d.hasOwnProperty("name")||d.hasOwnProperty("avatar"))){if(g.direction!==d.direction&&us(u,d.direction),g.layout!==d.layout&&ps(u,d.layout),g.direction!==d.direction||g.status!==d.status||g.message!==d.message){const m=u.querySelector(`.${cs}`);m&&hr(m,{direction:g.direction,status:g.status,message:g.message},{direction:d.direction,status:d.status,message:d.message})}if(g.name!==d.name||g.avatar!==d.avatar){const m=u.querySelector(`.${Jt}`);if(!d.name&&!d.avatar)return void(m==null?void 0:m.remove());if(m)ms(m,{name:g.name,avatar:g.avatar},{name:d.name,avatar:d.avatar});else if(d.name!==void 0||d.avatar!==void 0){const f={name:d.name,avatar:d.avatar},w=Kt(f),x=u.querySelector(`.${ds}`);x&&x.prepend(w)}}if(g.name!==d.name){const m=u.querySelector(`.${hs}`);m&&(m.textContent=d.name||"")}}})(n,l,h)}},onDestroy:()=>{n.remove(),a=void 0}}},({propName:r,newValue:e,dom:t})=>{var n;switch(r){case"markdownLinkTarget":case"skipStreamingAnimation":case"syntaxHighlighter":case"htmlSanitizer":case"showCodeBlockCopyButton":case"streamingAnimationSpeed":(n=t.actions)==null||n.updateMarkdownStreamRenderer({[r]:e})}})],ot);const fr=(r,e)=>{let t,n=e,s=r,o=!0;const i=((m,f)=>{let w=!1;if(typeof m!="function")throw new ce({source:"x/throttle",message:"Callback must be a function"});return(...x)=>{w||(m.apply(void 0,x),w=!0,setTimeout(function(){w=!1},f))}})((m=>{let f,w;return x=>{const y=x.target;if(!(y instanceof HTMLElement))return;const{scrollTop:S,clientHeight:v,scrollHeight:P}=y,A=P-30,B=Math.ceil(S+v)>=A,E=f===void 0||w===void 0?void 0:S>f&&w===P?"down":S<f&&w===P?"up":void 0;w=P,f=S,m({scrolledToBottom:B,scrollDirection:E})}})(({scrolledToBottom:m,scrollDirection:f})=>{o?f==="up"&&(o=!1):f==="down"&&m&&(o=!0)}),50),a=m=>{m.addEventListener("scroll",i)},p=m=>{m==null||m.removeEventListener("scroll",i)},c=m=>{(t==null?void 0:t.uid)===m&&(l==null||l.disconnect(),h==null||h.disconnect(),t=void 0,l=void 0,h=void 0)};let l,h;const u=()=>{s==null||s.scrollTo({top:5e4,behavior:"instant"})},g=()=>{s&&n&&o&&u()},d=()=>{g()};return a(s),{updateConversationContainer:m=>{p(s),a(m),s=m},updateProps:({autoScroll:m})=>{n=m},handleNewChatSegmentAdded:(m,f)=>{t&&(l==null||l.disconnect(),h==null||h.disconnect()),t={uid:m,container:f},l=new ResizeObserver(g),l.observe(f),h=new MutationObserver(d),h.observe(f,{childList:!0,subtree:!0,characterData:!0}),n&&u()},handleChatSegmentRemoved:m=>c(m),handleChatSegmentComplete:m=>c(m),destroy:()=>{t&&(c(t.uid),t=void 0),p(s),s=void 0}}},Ce=r=>{var n;const e=typeof r=="function"?r.__compId:void 0;if(!e)throw new Error("Invalid compClass! Component should be registered before using");const t=(n=Wn.retrieve(e))==null?void 0:n.model;if(!t||typeof t!="function")throw new Error(`Component "${e}" is not registered`);return{withContext:s=>({create:()=>new t(s,{}),withProps:o=>({create:()=>new t(s,o)})})}},kr=r=>{const e=["adapter","events"],t=Object.keys(r).filter(s=>!e.includes(s)),n={};for(let s=0;s<t.length;s++){const o=t[s];n[o]=r[o]}return n},gs=()=>{const r=document.createElement("div");r.classList.add("nlux-comp-messageLoader");const e=document.createElement("span");e.classList.add("spinning-loader");const t=document.createElement("div");return t.classList.add("nlux-comp-loaderContainer"),t.appendChild(e),r.appendChild(t),r},yn=r=>{const e="nlux-chatSegment";return r==="complete"?`${e} nlux-chatSegment--complete`:r==="error"?`${e} nlux-chatSegment--error`:`${e} nlux-chatSegment--active`},Je=(r,e)=>{var t,n;return r==="assistant"?((t=e==null?void 0:e.assistant)==null?void 0:t.name)??"AI":r==="user"?((n=e==null?void 0:e.user)==null?void 0:n.name)??"You":""},xr="list";var wr=Object.defineProperty,br=Object.getOwnPropertyDescriptor,Ke=(r,e,t,n)=>{for(var s,o=n>1?void 0:n?br(e,t):e,i=r.length-1;i>=0;i--)(s=r[i])&&(o=(n?s(e,t,o):s(o))||o);return n&&o&&wr(e,t,o),o};let be=class extends J{constructor(e,t){super(e,t),this.chatItemCompIdsByIndex=[],this.chatItemComponentsById=new Map}addChatItem(e){var s,o;if(this.throwIfDestroyed(),this.chatItemComponentsById.has(e.uid))throw new Error(`CompChatSegment: chat item with id "${e.uid}" already exists`);const t=((i,a,p,c)=>{const l=a??xr;if(i.participantRole==="assistant"){const u=i.status==="complete"?"complete":"streaming";return i.dataTransferMode==="stream"?{status:u,layout:l,direction:"received",name:Je("assistant",{assistant:c}),avatar:c==null?void 0:c.avatar}:i.status==="complete"?{status:u,layout:l,direction:"received",name:Je("assistant",{assistant:c}),avatar:c==null?void 0:c.avatar,message:(h=i.content,typeof h=="string"?h:typeof h=="object"?`${h}`:h==null?"":typeof h.toString=="function"?h.toString():JSON.stringify(h))}:{status:u,layout:l,direction:"received",name:Je("assistant",{assistant:c}),avatar:c==null?void 0:c.avatar}}var h;return{status:"complete",layout:l,direction:"sent",message:i.content,name:Je("user",{user:p}),avatar:p==null?void 0:p.avatar}})(e,this.getProp("conversationLayout"),this.getProp("userPersona"),this.getProp("assistantPersona"));if(!t)throw new Error(`CompChatSegment: chat item with id "${e.uid}" has invalid props`);const n=Ce(ot).withContext(this.context).withProps({uid:e.uid,domProps:t,markdownLinkTarget:this.getProp("markdownLinkTarget"),showCodeBlockCopyButton:this.getProp("showCodeBlockCopyButton"),skipStreamingAnimation:this.getProp("skipStreamingAnimation"),syntaxHighlighter:this.getProp("syntaxHighlighter"),htmlSanitizer:this.getProp("htmlSanitizer"),streamingAnimationSpeed:this.getProp("streamingAnimationSpeed")}).create();this.chatItemComponentsById.set(e.uid,n),this.chatItemCompIdsByIndex.push(e.uid),this.rendered&&((o=(s=this.renderedDom)==null?void 0:s.elements)!=null&&o.chatSegmentContainer?n.render(this.renderedDom.elements.chatSegmentContainer,this.renderedDom.elements.loaderContainer):St("CompChatSegment: chatSegmentContainer is not available"))}addChunk(e,t,n){if(this.destroyed)return;const s=this.chatItemComponentsById.get(e);if(!s)throw new Error(`CompChatSegment: chat item with id "${e}" not found`);s.addChunk(t,n)}complete(){this.throwIfDestroyed(),this.chatItemComponentsById.forEach(e=>e.commitChunks()),this.setProp("status","complete")}destroy(){this.chatItemComponentsById.forEach(e=>e.destroy()),this.chatItemComponentsById.clear(),this.chatItemCompIdsByIndex=[],super.destroy()}getChatItems(){return this.chatItemCompIdsByIndex.map(e=>this.chatItemComponentsById.get(e)).filter(e=>!!e)}setAssistantPersona(e){this.setProp("assistantPersona",e);const t={name:e==null?void 0:e.name,avatar:e==null?void 0:e.avatar};this.chatItemComponentsById.forEach(n=>{n.getChatSegmentItem().participantRole==="assistant"&&n.updateDomProps(t)})}setLayout(e){this.setProp("conversationLayout",e),this.chatItemComponentsById.forEach(t=>{t.updateDomProps({layout:e})})}setUserPersona(e){this.setProp("userPersona",e);const t={name:e==null?void 0:e.name,avatar:e==null?void 0:e.avatar};this.chatItemComponentsById.forEach(n=>{n.getChatSegmentItem().participantRole==="user"&&n.updateDomProps(t)})}updateMarkdownStreamRenderer(e,t){this.setProp(e,t)}onLoaderShown(e){var t;(t=this.renderedDom)!=null&&t.elements&&(this.renderedDom.elements.loaderContainer=e)}setProp(e,t){super.setProp(e,t),e!=="markdownLinkTarget"&&e!=="syntaxHighlighter"&&e!=="htmlSanitizer"&&e!=="skipStreamingAnimation"&&e!=="streamingAnimationSpeed"||this.chatItemComponentsById.forEach(n=>{n.updateMarkdownStreamRenderer(e,t)})}onChatSegmentReady(){ne(()=>{var t,n,s,o;if(!((n=(t=this.renderedDom)==null?void 0:t.elements)!=null&&n.chatSegmentContainer))return;const e=(o=(s=this.renderedDom)==null?void 0:s.elements)==null?void 0:o.chatSegmentContainer;this.chatItemComponentsById.forEach(i=>{i.rendered||i.render(e)})})}onLoaderHidden(){var e;(e=this.renderedDom)!=null&&e.elements&&(this.renderedDom.elements.loaderContainer=void 0)}};Ke([V("loader-shown")],be.prototype,"onLoaderShown",1),Ke([V("chat-segment-ready")],be.prototype,"onChatSegmentReady",1),Ke([V("loader-hidden")],be.prototype,"onLoaderHidden",1),be=Ke([pe("chatSegment",({props:r,compEvent:e,appendToRoot:t})=>{let n;const s=document.createElement("div");s.className=yn(r.status);const o=()=>{if(!n){n=document.createElement("div"),n.className="nlux-chatSegment-loader-container";const i=gs();n.appendChild(i),s.appendChild(n),e("loader-shown")(n)}};return r.status==="active"&&o(),t(s),e("chat-segment-ready")(),{elements:{chatSegmentContainer:s,loaderContainer:n},actions:{showLoader:o,hideLoader:()=>{n&&(n.remove(),n=void 0,e("loader-hidden")())}},onDestroy:()=>{s.remove()}}},({propName:r,newValue:e,dom:t})=>{var n,s,o;if(r==="status"){const i=(n=t.elements)==null?void 0:n.chatSegmentContainer;if(!i)return;const a=e;i.className=yn(a),a==="active"?(s=t.actions)==null||s.showLoader():(o=t.actions)==null||o.hideLoader()}})],be);let Tt=class extends J{constructor(e,t){super(e,t),this.chatSegmentCompIdsByIndex=[],this.chatSegmentComponentsById=new Map,t.messages&&t.messages.length>0&&this.addChatSegment("complete",t.messages)}addChatItem(e,t){const n=this.chatSegmentComponentsById.get(e);if(!n)throw new Error(`CompConversation: chat segment with id "${e}" not found`);n.destroyed?St(`CompConversation: chat segment with id "${e}" is destroyed and cannot be used`):n.addChatItem(t)}addChatSegment(e="active",t){this.throwIfDestroyed();const n=se(),s=Ce(be).withContext(this.context).withProps({uid:n,status:e,conversationLayout:this.getProp("conversationLayout"),userPersona:this.getProp("userPersona"),assistantPersona:this.getProp("assistantPersona"),markdownLinkTarget:this.getProp("markdownLinkTarget"),showCodeBlockCopyButton:this.getProp("showCodeBlockCopyButton"),skipStreamingAnimation:this.getProp("skipStreamingAnimation"),syntaxHighlighter:this.getProp("syntaxHighlighter"),htmlSanitizer:this.getProp("htmlSanitizer"),streamingAnimationSpeed:this.getProp("streamingAnimationSpeed")}).create();if(t)for(const i of t)i.role==="assistant"?s.addChatItem({uid:se(),participantRole:"assistant",time:new Date,dataTransferMode:"batch",status:"complete",content:i.message,serverResponse:i.serverResponse}):i.role==="user"&&s.addChatItem({uid:se(),participantRole:"user",time:new Date,status:"complete",content:i.message});this.chatSegmentComponentsById.set(n,s),this.chatSegmentCompIdsByIndex.push(n);const o=s.id;return this.addSubComponent(o,s,"segmentsContainer"),this.notifyAboutSegmentCountChange(this.chatSegmentCompIdsByIndex.length),n}addChunk(e,t,n,s){const o=this.chatSegmentComponentsById.get(e);if(!o)throw new Error(`CompConversation: chat segment with id "${e}" not found`);o.addChunk(t,n,s)}completeChatSegment(e){const t=this.chatSegmentComponentsById.get(e);if(!t)throw new Error(`CompConversation: chat segment with id "${e}" not found`);t.destroyed||t.complete()}getChatSegmentContainer(e){const t=this.chatSegmentComponentsById.get(e);if((t==null?void 0:t.root)instanceof HTMLElement)return t.root}getConversationContentForAdapter(e="max"){if(typeof e=="number"&&e<0)return void St(`Invalid value provided for 'historyPayloadSize' : "${e}"! Value must be a positive integer or 'max'.`);if(e===0)return;const t=(n=>{const s=[];return n.forEach(o=>{o.items.forEach(i=>{if(i.status==="complete"){if(i.participantRole==="assistant")s.push({role:"assistant",message:i.content});else if(i.participantRole==="user")return s.push({role:"user",message:i.content})}})}),s})(this.chatSegmentCompIdsByIndex.map(n=>this.chatSegmentComponentsById.get(n)).filter(n=>n!==void 0).map(n=>({uid:n.id,status:"complete",items:n.getChatItems().map(s=>s.getChatSegmentItem())})));return e==="max"?t:t.slice(-e)}removeChatSegment(e){const t=this.chatSegmentComponentsById.get(e);if(!t)return;const n=t.id;this.subComponents.has(n)&&this.removeSubComponent(n),this.chatSegmentComponentsById.delete(t.id);const s=this.chatSegmentCompIdsByIndex.indexOf(e);s>=0&&this.chatSegmentCompIdsByIndex.splice(s,1),this.notifyAboutSegmentCountChange(this.chatSegmentCompIdsByIndex.length)}setAssistantPersona(e){this.setProp("assistantPersona",e),this.chatSegmentComponentsById.forEach(t=>{t.setAssistantPersona(e)})}setConversationLayout(e){this.setProp("conversationLayout",e),this.chatSegmentComponentsById.forEach(t=>{t.setLayout(e)})}setUserPersona(e){this.setProp("userPersona",e),this.chatSegmentComponentsById.forEach(t=>{t.setUserPersona(e)})}updateMarkdownStreamRenderer(e,t){this.setProp(e,t)}setProp(e,t){if(super.setProp(e,t),e==="markdownLinkTarget"||e==="syntaxHighlighter"||e==="htmlSanitizer"||e==="skipStreamingAnimation"||e==="streamingAnimationSpeed"||e==="showCodeBlockCopyButton"){const n=e,s=t;this.chatSegmentComponentsById.forEach(o=>{o.updateMarkdownStreamRenderer(n,s)})}}notifyAboutSegmentCountChange(e){const t=this.getProp("onSegmentCountChange");t&&t(e)}};Tt=((r,e,t,n)=>{for(var s,o=e,i=r.length-1;i>=0;i--)(s=r[i])&&(o=s(o)||o);return o})([pe("conversation",({appendToRoot:r})=>{const e=document.createElement("div");return e.classList.add("nlux-chatSegments-container"),r(e),{elements:{segmentsContainer:e},actions:{}}},()=>{})],Tt);const bt={typing:"nlux-composer--typing","submitting-prompt":"nlux-composer--submitting","submitting-conversation-starter":"nlux-composer--submitting",waiting:"nlux-composer--waiting"},fs=(r,e)=>{Object.keys(bt).forEach(t=>{r.classList.remove(bt[t])}),r.classList.add(bt[e])},yr=r=>{const e=document.createElement("div");e.classList.add("nlux-comp-composer");const t=document.createElement("textarea");t.placeholder=r.placeholder??"",t.value=r.message??"",r.autoFocus&&(t.autofocus=!0);const n=document.createElement("button");return n.append((()=>{const s=document.createElement("div");s.classList.add("nlux-comp-sendIcon");const o=document.createElement("div");return o.classList.add("nlux-comp-sendIcon-container"),s.appendChild(o),s})()),n.append(gs()),e.append(t),e.append(n),fs(e,r.status),r.status!=="submitting-conversation-starter"&&r.status!=="submitting-prompt"||(t.disabled=!0,n.disabled=!0),r.status==="waiting"&&(n.disabled=!0),r.status==="typing"&&(n.disabled=r.disableSubmitButton??t.value===""),e},pt=(r,e)=>{let t=!1;const n=e?r.querySelector(e):r,s=n instanceof HTMLElement?n:void 0;if(!s)throw new at({source:"dom/listenTo",message:`Could not find element with query "${e}". Make sure the query provided matches an element that exists in the root element.`});const o=new Map,i=new Map,a=()=>{s&&(o.forEach((c,l)=>{s.removeEventListener(l,c)}),o.clear(),i.clear())},p={on:(c,l)=>{if(!l||!s)return p;if(!o.has(c)){const h=u=>{var g;(g=i.get(c))==null||g.forEach(d=>d(u))};o.set(c,h),s.addEventListener(c,h)}return i.has(c)||i.set(c,new Set),i.get(c).add(l),p},get:()=>{if(t)throw new Error("listenTo().get() can only be used once!");return t=!0,[s,a]}};return p};var vr=Object.defineProperty,Cr=Object.getOwnPropertyDescriptor,Ie=(r,e,t,n)=>{for(var s,o=n>1?void 0:n?Cr(e,t):e,i=r.length-1;i>=0;i--)(s=r[i])&&(o=(n?s(e,t,o):s(o))||o);return n&&o&&vr(e,t,o),o};let ge=class extends J{constructor(e,{props:t,eventListeners:n}){super(e,t),this.userEventListeners=n}focusTextInput(){this.executeDomAction("focusTextInput")}handleCommandEnterKeyPressed(e){var n;((n=this.getProp("domCompProps"))==null?void 0:n.submitShortcut)==="CommandEnter"&&(this.handleSendButtonClick(),e==null||e.preventDefault())}handleEnterKeyPressed(e){var n;const t=(n=this.getProp("domCompProps"))==null?void 0:n.submitShortcut;t&&t!=="Enter"||(this.handleSendButtonClick(),e==null||e.preventDefault())}handleSendButtonClick(){var s;const e=this.getProp("domCompProps");if(e!=null&&e.disableSubmitButton||!(e==null?void 0:e.message))return;const n=(s=this.userEventListeners)==null?void 0:s.onSubmit;n&&n()}handleTextChange(e){var s;const t=(s=this.userEventListeners)==null?void 0:s.onTextUpdated;t&&t(e);const n=this.getProp("domCompProps");this.setDomProps({...n,message:e})}handleTextInputUpdated(e){const t=e.target;t instanceof HTMLTextAreaElement&&this.handleTextChange(t.value)}setDomProps(e){this.setProp("domCompProps",e)}};Ie([V("command-enter-key-pressed")],ge.prototype,"handleCommandEnterKeyPressed",1),Ie([V("enter-key-pressed")],ge.prototype,"handleEnterKeyPressed",1),Ie([V("send-message-clicked")],ge.prototype,"handleSendButtonClick",1),Ie([V("text-updated")],ge.prototype,"handleTextInputUpdated",1),ge=Ie([pe("composer",({appendToRoot:r,props:e,compEvent:t})=>{const n=yr(e.domCompProps);r(n);const[s,o]=pt(n,":scope > textarea").on("input",t("text-updated")).on("keydown",l=>{const h=l.key==="Enter",u=l.altKey||l.ctrlKey||l.metaKey||l.shiftKey;if(h&&!u)return void t("enter-key-pressed")(l);const g=l.getModifierState("Meta")&&l.key==="Enter",d=l.getModifierState("Control")&&l.key==="Enter";(g||d)&&t("command-enter-key-pressed")(l)}).get(),[i,a]=pt(n,":scope > button").on("click",t("send-message-clicked")).get();if(!(i instanceof HTMLButtonElement))throw new Error("Expected a button element");if(!(s instanceof HTMLTextAreaElement))throw new at({source:(p="composer",c="render",`#${p}/${c}`),message:"Expected a textarea element"});var p,c;return{elements:{root:n,textInput:s,sendButton:i},actions:{focusTextInput:()=>ne(()=>{s.focus(),s.setSelectionRange(s.value.length,s.value.length)})},onDestroy:()=>{o(),a()}}},({propName:r,currentValue:e,newValue:t,dom:n})=>{var s;r==="domCompProps"&&((s=n.elements)!=null&&s.root)&&((o,i,a)=>{if(i.status===a.status&&i.message===a.message&&i.placeholder===a.placeholder&&i.autoFocus===a.autoFocus&&i.disableSubmitButton===a.disableSubmitButton)return;if(i.status!==a.status)return fs(o,a.status),void((c,l,h)=>{if(l.status===h.status)return;const u=c.querySelector("* > textarea");h.status!=="typing"&&h.status!=="waiting"||!u.disabled?h.status!=="submitting-prompt"&&h.status!=="submitting-conversation-starter"||u.disabled||(u.disabled=!0):u.disabled=!1;const g=c.querySelector("* > button");if(h.status==="typing"){const d=(l.disableSubmitButton!==h.disableSubmitButton?h.disableSubmitButton:l.disableSubmitButton)??u.value==="";g.disabled!==d&&(g.disabled=d)}else h.status!=="waiting"&&h.status!=="submitting-prompt"&&h.status!=="submitting-conversation-starter"||g.disabled||(g.disabled=!0);l.placeholder!==h.placeholder&&(u.placeholder=h.placeholder??""),l.message!==h.message&&(u.value=h.message??""),l.autoFocus!==h.autoFocus&&(u.autofocus=h.autoFocus??!1)})(o,i,a);const p=o.querySelector("* > textarea");if(i.placeholder!==a.placeholder&&(p.placeholder=a.placeholder??""),i.autoFocus!==a.autoFocus&&(p.autofocus=a.autoFocus??!1),i.message!==a.message&&(p.value=a.message??""),i.status==="typing"){const c=o.querySelector("* > button"),l=(i.disableSubmitButton!==a.disableSubmitButton?a.disableSubmitButton:i.disableSubmitButton)??p.value==="";c.disabled!==l&&(c.disabled=l)}})(n.elements.root,e,t)})],ge);const Lt=r=>{if(typeof r!="object"||r===null)return!1;const e=r;return(typeof e.streamText=="function"||typeof e.batchText=="function")&&["stream","batch"].includes(e.dataTransferMode)&&typeof e.id=="string"&&typeof e.info=="object"&&e.info!==null&&typeof e.preProcessAiBatchedMessage=="function"&&typeof e.preProcessAiStreamedChunk=="function"},F=r=>{setTimeout(()=>{r()},1)},Sr=(r,e,t,n,s,o,i,a,p)=>new Promise(c=>{const l=se(),h=[],u=[];let g=!1,d=!1,m=!1;const f=Lt(t),w={next:x=>{if(d||m)return;let y,S;if(f){const v=x,P=t.preProcessAiStreamedChunk(v,n);P!=null&&(y=P,S=v,h.push(y),u.push(S))}else y=x,h.push(y);y!=null?(g||g||(g=!0,F(()=>{s.forEach(v=>{v({uid:l,status:"streaming",time:new Date,participantRole:"assistant",dataTransferMode:"stream"})})})),F(()=>{i.forEach(v=>{v({chunk:y,messageId:l,serverResponse:S})})})):U("Adapter returned an undefined or null value from streamText. This chunk will be ignored.")},complete:()=>{d||m||(m=!0,F(()=>{const x={uid:l,status:"complete",content:h,serverResponse:void 0,time:new Date,participantRole:"assistant",dataTransferMode:"stream"};o.forEach(y=>{y(x)}),c()}),F(()=>{const x={uid:r,status:"complete",items:[e,{uid:l,status:"complete",content:h,serverResponse:u,time:new Date,participantRole:"assistant",dataTransferMode:"stream"}]};a.forEach(y=>{y(x)})}))},error:x=>{d||m||(d=!0,F(()=>{p.forEach(y=>{y("failed-to-stream-content",x)}),c()}))}};t.streamText(e.content,w,n)}),Ar=(r,e,t)=>{if(!r)return(()=>{const d=new Set,m=se(),f={uid:m,status:"complete",items:[]};return F(()=>{d.forEach(w=>{w(f)}),d.clear()}),{segment:f,observable:{on:(w,x)=>{w==="complete"&&d.add(x)},removeListener:(w,x)=>{d.delete(x)},destroy:()=>{d.clear()},get segmentId(){return m}},dataTransferMode:"batch"}})();if(e.streamText===void 0&&e.batchText===void 0)return(d=>{const m=new Set,f=se(),w={uid:f,status:"error",items:[]};return F(()=>{m.forEach(x=>x(d)),m.clear()}),{segment:w,dataTransferMode:"stream",observable:{on:(x,y)=>{x==="error"&&m.add(y)},removeListener:(x,y)=>{m.delete(y)},destroy:()=>{m.clear()},get segmentId(){return f}}}})("no-data-transfer-mode-supported");const n=se(),s=(d=>({uid:se(),time:new Date,status:"complete",participantRole:"user",content:d}))(r);let o,i,a,p,c=new Set,l=new Set,h=new Set;F(()=>{c!=null&&c.size&&(c.forEach(d=>{d(s)}),c.clear(),c=void 0)});const u=(d=>{const m=[];d.streamText!==void 0&&m.push("stream"),d.batchText!==void 0&&m.push("batch");const f=Lt(d)?d:void 0,w=(f==null?void 0:f.dataTransferMode)??void 0,x=m.length===1?m[0]:"stream";return w??x})(e);u==="batch"?(o=new Set,(async(d,m,f,w,x,y,S)=>{try{const v=m.content,P=Lt(f)?f:void 0,A=P!==void 0,B=se(),E="assistant",T="complete",H=new Date,N="batch";let j;if(A){const q=await P.batchText(v,w),re=P.preProcessAiBatchedMessage(q,w);re!=null&&(j={uid:B,content:re,serverResponse:q,participantRole:E,status:T,time:H,dataTransferMode:N})}else j={uid:B,content:await f.batchText(v,w),serverResponse:void 0,participantRole:E,status:T,time:H,dataTransferMode:N};if(!j)throw new Error("Response from adapter was undefined or cannot be processed");const de=j;F(()=>{x.forEach(q=>{q(de)})});const $={uid:d,status:"complete",items:[m,j]};F(()=>{y.forEach(q=>{q($)})})}catch(v){U(v);const P=v instanceof Error?v:typeof v=="string"?new Error(v):new Error("Unknown error");F(()=>{S.forEach(A=>A("failed-to-load-content",P))})}})(n,s,e,t,o,l,h).finally(()=>{F(()=>g())})):(i=new Set,a=new Set,p=new Set,Sr(n,s,e,t,i,a,p,l,h).finally(()=>{F(()=>g())}));const g=()=>{c==null||c.clear(),c=void 0,o==null||o.clear(),o=void 0,i==null||i.clear(),i=void 0,a==null||a.clear(),a=void 0,p==null||p.clear(),p=void 0,l==null||l.clear(),l=void 0,h==null||h.clear(),h=void 0};return{segment:{status:"active",uid:n,items:[]},dataTransferMode:u,observable:{get segmentId(){return n},on:(d,m)=>{d==="userMessageReceived"&&c?c.add(m):d==="aiMessageReceived"&&o?o.add(m):d==="aiMessageStreamStarted"&&i?i.add(m):d==="aiMessageStreamed"&&a?a.add(m):d==="aiChunkReceived"&&p?p.add(m):d==="complete"&&l?l.add(m):d==="error"&&h&&h.add(m)},removeListener:(d,m)=>{d!=="userMessageReceived"?d!=="aiMessageReceived"?d!=="aiMessageStreamStarted"?d!=="aiMessageStreamed"?d!=="aiChunkReceived"?d!=="complete"?d!=="error"||(h==null||h.delete(m)):l==null||l.delete(m):p==null||p.delete(m):a==null||a.delete(m):i==null||i.delete(m):o==null||o.delete(m):c==null||c.delete(m)},destroy:()=>g()}}},Ir={"data-transfer-mode-not-supported":"Requested data transfer mode is not supported","no-data-transfer-mode-supported":"Adapter does not support any valid data transfer modes","connection-error":"Connection error","invalid-credentials":"Invalid credentials","invalid-api-key":"Invalid API key","http-server-side-error":"HTTP server side error","http-client-side-error":"HTTP client side error","failed-to-load-content":"Failed to load content","failed-to-stream-content":"Failed to stream content","failed-to-render-content":"Failed to display content"},Rt=(r,e)=>r!==void 0&&r.length>0||e!==void 0&&e>0?"active":"starting",vn="nlux-comp-welcomeMessage-text",ks=(r,e)=>{const t=r.querySelector(`.${vn}`);if(e!==""&&e!==void 0)if(t)t.textContent=e;else{const n=document.createElement("div");n.classList.add(vn),n.textContent=e,r.appendChild(n)}else t==null||t.remove()},xs="nlux-comp-welcomeMessage-personaName",Mt=r=>{const e=document.createElement("div");e.classList.add("nlux-comp-welcomeMessage");const t=Kt({name:r.name,avatar:r.avatar});e.append(t);const n=document.createElement("div"),s=document.createTextNode(r.name);return n.append(s),n.classList.add(xs),e.append(n),ks(e,r.message),e},Cn=()=>Mt({name:"",avatar:"data:image/png;base64,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"});var Er=Object.defineProperty,Pr=Object.getOwnPropertyDescriptor,Sn=(r,e,t,n)=>{for(var s,o=n>1?void 0:n?Pr(e,t):e,i=r.length-1;i>=0;i--)(s=r[i])&&(o=(n?s(e,t,o):s(o))||o);return n&&o&&Er(e,t,o),o};let it=class extends J{constructor(r,e){super(r,e),this.updateConversationStarters=t=>{}}conversationStarterClicked(r){this.getProp("onConversationStarterSelected")(r)}};Sn([V("conversation-starter-selected")],it.prototype,"conversationStarterClicked",1),it=Sn([pe("conversationStarters",({appendToRoot:r,props:e,compEvent:t})=>{const n=(o=>{const i=document.createElement("div");return i.classList.add("nlux-comp-conversationStarters"),o.forEach((a,p)=>{const c=document.createElement("button");c.classList.add("nlux-comp-conversationStarter");const l=document.createElement("span");l.classList.add("nlux-comp-conversationStarter-prompt"),l.textContent=a.prompt,c.appendChild(l),i.appendChild(c)}),i})(e.conversationStarters);r(n);let s=[];return e.conversationStarters.forEach((o,i)=>{const[a,p]=pt(n,`:scope > :nth-child(${i+1})`).on("click",()=>{t("conversation-starter-selected")(o)}).get();s.push(p)}),{elements:{},actions:{},onDestroy:()=>{s.forEach(o=>o()),s=[],n.remove()}}},({})=>{})],it);let Ot=class extends J{constructor(r,e){super(r,e),this.setConversationStarters(e.conversationStarters)}setConversationStarters(r){var e;if(r||this.conversationStartersComp){if(r&&!this.conversationStartersComp){const t=this.getProp("onConversationStarterSelected");return this.conversationStartersComp=Ce(it).withContext(this.context).withProps({conversationStarters:r,onConversationStarterSelected:t}).create(),void this.addSubComponent(this.conversationStartersComp.id,this.conversationStartersComp,"conversationStartersContainer")}!r&&this.conversationStartersComp?(this.removeSubComponent(this.conversationStartersComp.id),this.conversationStartersComp=void 0):(e=this.conversationStartersComp)==null||e.updateConversationStarters(r)}}setShowWelcomeMessage(r){this.setProp("showWelcomeMessage",r),this.executeDomAction("resetWelcomeMessage",r)}setAssistantPersona(r){this.setProp("assistantPersona",r),this.executeDomAction("updateAssistantPersona",r)}resetConversationStarters(){const r=this.getProp("conversationStarters");this.setConversationStarters(r)}};Ot=((r,e,t,n)=>{for(var s,o=e,i=r.length-1;i>=0;i--)(s=r[i])&&(o=s(o)||o);return o})([pe("launchPad",({appendToRoot:r,props:e})=>{const t={assistantPersona:e.assistantPersona,conversationStarters:e.conversationStarters,showWelcomeMessage:e.showWelcomeMessage!==!1};let n;if(t.showWelcomeMessage)if(e.assistantPersona){const i=e.assistantPersona;n=Mt({name:i.name,avatar:i.avatar,message:i.tagline})}else n=Cn();n&&(r(n),t.welcomeMessageElement=n);const s=document.createElement("div");s.classList.add("nlux-conversationStarters-container"),r(s);const o=(i=!0)=>{t.showWelcomeMessage=i,t.welcomeMessageElement&&(t.welcomeMessageElement.remove(),t.welcomeMessageElement=void 0),i&&(t.welcomeMessageElement=t.assistantPersona?Mt({name:t.assistantPersona.name,avatar:t.assistantPersona.avatar,message:t.assistantPersona.tagline}):Cn(),t.welcomeMessageElement&&s.insertAdjacentElement("beforebegin",t.welcomeMessageElement))};return{elements:{conversationStartersContainer:s},actions:{resetWelcomeMessage:(i=!0)=>{o(i)},updateAssistantPersona:i=>{const a=t.assistantPersona;t.assistantPersona=i,(a||i)&&t.showWelcomeMessage&&(i&&a?((p,c,l)=>{if(c.message!==l.message||c.name!==l.name||c.avatar!==l.avatar){if(c.message!==l.message&&ks(p,l.message),c.name!==l.name){const h=p.querySelector(`.${xs}`);if(h){const u=document.createTextNode(l.name);h.replaceChildren(u)}}if(c.avatar!==l.avatar||c.name!==l.name){const h=p.querySelector(`.${Jt}`);h&&ms(h,{name:c.name,avatar:c.avatar},{name:l.name,avatar:l.avatar})}}})(t.welcomeMessageElement,{name:a==null?void 0:a.name,avatar:a==null?void 0:a.avatar,message:a==null?void 0:a.tagline},{name:i.name,avatar:i.avatar,message:i.tagline}):o())}},onDestroy:()=>{var i;(i=t.welcomeMessageElement)==null||i.remove(),s.remove()}}},({})=>{})],Ot);var Br=Object.defineProperty,Tr=Object.getOwnPropertyDescriptor,yt=(r,e,t,n)=>{for(var s,o=n>1?void 0:n?Tr(e,t):e,i=r.length-1;i>=0;i--)(s=r[i])&&(o=(n?s(e,t,o):s(o))||o);return n&&o&&Br(e,t,o),o};let Ge=class extends J{constructor(r,{conversationLayout:e,autoScroll:t,streamingAnimationSpeed:n,visible:s=!0,composer:o,assistantPersona:i,userPersona:a,showWelcomeMessage:p,conversationStarters:c,initialConversationContent:l,syntaxHighlighter:h,htmlSanitizer:u,markdownLinkTarget:g,showCodeBlockCopyButton:d,skipStreamingAnimation:m}){if(super(r,{conversationLayout:e,visible:s,autoScroll:t,streamingAnimationSpeed:n,assistantPersona:i,userPersona:a,conversationStarters:c,showWelcomeMessage:p,initialConversationContent:l,composer:o,syntaxHighlighter:h,htmlSanitizer:u,markdownLinkTarget:g,showCodeBlockCopyButton:d,skipStreamingAnimation:m}),this.prompt="",this.handleConversationStarterClick=f=>{this.composer.setDomProps({status:"submitting-conversation-starter"}),this.composer.handleTextChange(f.prompt),this.composer.handleSendButtonClick()},this.handleSegmentCountChange=f=>{var x,y;if(this.segmentCount===f)return;this.segmentCount=f;const w=Rt(this.getProp("initialConversationContent")||void 0,this.segmentCount);this.chatRoomStatus!==w&&(this.chatRoomStatus=w,this.executeDomAction("updateChatRoomStatus",this.chatRoomStatus),this.chatRoomStatus==="active"?(x=this.launchPad)!=null&&x.id&&(this.removeSubComponent((y=this.launchPad)==null?void 0:y.id),this.launchPad=void 0):this.addLaunchPad(this.getProp("showWelcomeMessage")??!0,this.getProp("assistantPersona"),this.getProp("conversationStarters"),this.handleConversationStarterClick))},this.segmentCount=l&&l.length>0?1:0,this.chatRoomStatus=Rt(l,this.segmentCount),this.chatRoomStatus==="starting"&&this.addLaunchPad(p,i,c,this.handleConversationStarterClick),this.addConversation(i,a,l),this.addComposer(o==null?void 0:o.placeholder,o==null?void 0:o.autoFocus,o==null?void 0:o.disableSubmitButton,o==null?void 0:o.submitShortcut),!this.conversation||!this.composer)throw new Error("Chat room not initialized — An error occurred while initializing key components.")}getConversationContentForAdapter(r="max"){return this.conversation.getConversationContentForAdapter(r)}hide(){this.setProp("visible",!1)}messagesContainerClicked(){var r;(r=this.composer)==null||r.focusTextInput()}onChatRoomReady(){ne(()=>{var e,t;const r=(t=(e=this.renderedDom)==null?void 0:e.elements)==null?void 0:t.conversationContainer;if(r instanceof HTMLElement){this.autoScrollController=fr(r,this.getProp("autoScroll")??!0);let n=0;const s=20,o=()=>{r.scrollHeight>r.clientHeight&&(r.scrollTo({behavior:"smooth",top:5e4}),clearInterval(i))},i=setInterval(()=>{n>=s?clearInterval(i):(o(),n++)},10)}this.context.emit("ready",{aiChatProps:kr(this.context.aiChatProps)})})}setProps(r){var e,t,n,s,o,i,a;if(r.hasOwnProperty("autoScroll")){const p=r.autoScroll;(e=this.autoScrollController)==null||e.updateProps({autoScroll:p})}if(r.hasOwnProperty("conversationLayout")&&((t=this.conversation)==null||t.setConversationLayout(r.conversationLayout)),r.hasOwnProperty("syntaxHighlighter")&&this.setProp("syntaxHighlighter",r.syntaxHighlighter),r.hasOwnProperty("htmlSanitizer")&&this.setProp("htmlSanitizer",r.htmlSanitizer),r.hasOwnProperty("markdownLinkTarget")&&this.setProp("markdownLinkTarget",r.markdownLinkTarget),r.hasOwnProperty("skipStreamingAnimation")&&this.setProp("skipStreamingAnimation",r.skipStreamingAnimation),r.hasOwnProperty("streamingAnimationSpeed")&&this.setProp("streamingAnimationSpeed",r.streamingAnimationSpeed),r.hasOwnProperty("assistantPersona")&&((n=this.conversation)==null||n.setAssistantPersona(r.assistantPersona??void 0),(s=this.launchPad)==null||s.setAssistantPersona(r.assistantPersona??void 0)),r.hasOwnProperty("userPersona")&&((o=this.conversation)==null||o.setUserPersona(r.userPersona??void 0)),r.hasOwnProperty("showWelcomeMessage")&&((i=this.launchPad)==null||i.setShowWelcomeMessage(r.showWelcomeMessage??!0)),r.hasOwnProperty("conversationStarters")&&((a=this.launchPad)==null||a.setConversationStarters(r.conversationStarters)),r.hasOwnProperty("composer")&&this.composer){const p={...this.composer.getProp("domCompProps"),...r.composer};this.composer.setDomProps(p)}}show(){this.setProp("visible",!0)}setProp(r,e){if(super.setProp(r,e),r==="markdownLinkTarget"||r==="syntaxHighlighter"||r==="htmlSanitizer"||r==="skipStreamingAnimation"||r==="streamingAnimationSpeed"){const t=r,n=e;this.conversation.updateMarkdownStreamRenderer(t,n)}}addLaunchPad(r,e,t,n){this.launchPad=Ce(Ot).withContext(this.context).withProps({showWelcomeMessage:r,assistantPersona:e,conversationStarters:t,onConversationStarterSelected:n}).create(),this.addSubComponent(this.launchPad.id,this.launchPad,"launchPadContainer")}addConversation(r,e,t){this.conversation=Ce(Tt).withContext(this.context).withProps({assistantPersona:r,userPersona:e,messages:t,conversationLayout:this.getProp("conversationLayout"),markdownLinkTarget:this.getProp("markdownLinkTarget"),showCodeBlockCopyButton:this.getProp("showCodeBlockCopyButton"),skipStreamingAnimation:this.getProp("skipStreamingAnimation"),streamingAnimationSpeed:this.getProp("streamingAnimationSpeed"),syntaxHighlighter:this.getProp("syntaxHighlighter"),htmlSanitizer:this.getProp("htmlSanitizer"),onSegmentCountChange:this.handleSegmentCountChange}).create(),this.addSubComponent(this.conversation.id,this.conversation,"conversationContainer")}addComposer(r,e,t,n){this.composer=Ce(ge).withContext(this.context).withProps({props:{domCompProps:{status:"typing",placeholder:r,autoFocus:e,disableSubmitButton:t,submitShortcut:n}},eventListeners:{onTextUpdated:s=>this.handleComposerTextChange(s),onSubmit:()=>this.handleComposerSubmit()}}).create(),this.addSubComponent(this.composer.id,this.composer,"composerContainer")}handleComposerSubmit(){const r=this.props.composer;(({context:e,composerInstance:t,conversation:n,autoScrollController:s,messageToSend:o,resetComposer:i,setComposerAsWaiting:a})=>()=>{var c,l;const p=n.addChatSegment();try{const h=t.getProp("domCompProps");t.setDomProps({...h,status:"submitting-prompt"});const u={aiChatProps:e.aiChatProps,conversationHistory:n.getConversationContentForAdapter((l=(c=e.aiChatProps)==null?void 0:c.conversationOptions)==null?void 0:l.historyPayloadSize)},g=Ar(o,e.adapter,u);g.observable.on("error",(d,m)=>{n.removeChatSegment(p),s==null||s.handleChatSegmentRemoved(p),i(!1),e.exception(d),e.emit("error",{errorId:d,message:Ir[d],errorObject:m})}),g.observable.on("userMessageReceived",d=>{n.addChatItem(p,d),e.emit("messageSent",{uid:d.uid,message:d.content}),ne(()=>{if(s){const m=n.getChatSegmentContainer(p);m&&s.handleNewChatSegmentAdded(p,m)}})}),g.dataTransferMode==="batch"?g.observable.on("aiMessageReceived",d=>{const m=typeof d.content=="string",f={...d,content:m?"":d.content};n.addChatItem(p,f),m&&n.addChunk(p,f.uid,d.content,d.serverResponse),n.completeChatSegment(p),e.emit("messageReceived",{uid:d.uid,message:d.content}),i(!0)}):(g.observable.on("aiMessageStreamStarted",d=>{n.addChatItem(p,d),a(),e.emit("messageStreamStarted",{uid:d.uid})}),g.observable.on("aiChunkReceived",d=>{const{messageId:m,chunk:f,serverResponse:w}=d;n.addChunk(p,m,f,w)}),g.observable.on("aiMessageStreamed",d=>{d.status==="complete"&&e.emit("messageReceived",{uid:d.uid,message:d.content})}),g.observable.on("complete",()=>{n.completeChatSegment(p),i(!1)}))}catch(h){U(h),i(!1)}})({context:this.context,composerInstance:this.composer,conversation:this.conversation,messageToSend:this.prompt,autoScrollController:this.autoScrollController,resetComposer:e=>{this.destroyed||this.resetComposer(e,r==null?void 0:r.autoFocus)},setComposerAsWaiting:()=>{this.destroyed||this.composer.setDomProps({status:"waiting"})}})()}handleComposerTextChange(r){this.prompt=r}resetComposer(r=!1,e=!1){if(!this.composer)return;const t={...this.composer.getProp("domCompProps"),status:"typing"};r&&(t.message=""),this.composer.setDomProps(t),e&&this.composer.focusTextInput()}};yt([V("conversation-container-clicked")],Ge.prototype,"messagesContainerClicked",1),yt([V("chat-room-ready")],Ge.prototype,"onChatRoomReady",1),Ge=yt([pe("chatRoom",({appendToRoot:r,compEvent:e,props:t})=>{const n=document.createElement("div");n.classList.add("nlux-conversation-container");const s=document.createElement("div");s.classList.add("nlux-composer-container");const o=document.createElement("div");o.classList.add("nlux-launchPad-container");const i=document.createDocumentFragment();i.appendChild(o),i.appendChild(n),i.appendChild(s);const a=t.visible??!0,p=document.createElement("div"),c=u=>{p.classList.remove("nlux-chatRoom-starting"),p.classList.remove("nlux-chatRoom-active"),p.classList.add(`nlux-chatRoom-${u}`)};p.classList.add("nlux-chatRoom-container"),c(Rt(t.initialConversationContent)),p.append(i),p.style.display=a?"":"none";const[l,h]=pt(p,":scope > .nlux-conversation-container").on("click",e("conversation-container-clicked")).get();return r(p),e("chat-room-ready")(),{elements:{composerContainer:s,conversationContainer:n,launchPadContainer:o},actions:{updateChatRoomStatus:u=>{c(u)}},onDestroy:()=>{h()}}},({propName:r,newValue:e,dom:{elements:t}})=>{})],Ge);const Lr=r=>{const e=new Set;let t=!1,n=null,s=null;const o=()=>{if(t||e.size===0)return;t=!0;const a=e.values().next().value;e.delete(a),n=(({message:p})=>{const c=document.createElement("div");c.classList.add("nlux-comp-exceptionItem");const l=document.createElement("span");return l.classList.add("nlux-comp-exp_itm_msg"),l.append(document.createTextNode(p)),c.append(l),c})(a),r.append(n),s=setTimeout(i,3e3)},i=()=>{n==null||n.classList.add("nlux-comp-exceptionItem--hiding"),s=setTimeout(()=>{t=!1,n==null||n.remove(),n=null,o()},500)};return{displayException:a=>{e.add({message:a}),t||o()},destroy:()=>{e.clear(),n==null||n.remove(),s&&clearTimeout(s)}}};let An=class extends J{constructor(r,e){super(r,e)}destroy(){super.destroy()}showAlert(r,e){this.executeDomAction("displayException",e)}};An=((r,e,t,n)=>{for(var s,o=e,i=r.length-1;i>=0;i--)(s=r[i])&&(o=s(o)||o);return o})([pe("exceptionsBox",({props:r,appendToRoot:e})=>{const t=(()=>{const s=document.createElement("div");return s.classList.add("nlux-comp-exceptionBox"),s})();e(t);let n=Lr(t);return{elements:{root:t},actions:{displayException:s=>{n==null||n.displayException(s)}},onDestroy:()=>{n==null||n.destroy(),t.remove(),n=void 0}}},()=>{})],An);const Rr=r=>{const e=new Set;let t=!1,n=null,s=null;const o=()=>{if(t||e.size===0)return;t=!0;const a=e.values().next().value;e.delete(a),n=(({message:p})=>{const c=document.createElement("div");c.classList.add("nlux-comp-exceptionItem");const l=document.createElement("span");return l.classList.add("nlux-comp-exp_itm_msg"),l.append(document.createTextNode(p)),c.append(l),c})(a),r.append(n),s=setTimeout(i,3e3)},i=()=>{n==null||n.classList.add("nlux-comp-exceptionItem--hiding"),s=setTimeout(()=>{t=!1,n==null||n.remove(),n=null,o()},500)};return{displayException:a=>{e.add({message:a}),t||o()},destroy:()=>{e.clear(),n==null||n.remove(),s&&clearTimeout(s)}}},ue=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const e=16*Math.random()|0;return(r=="x"?e:3&e|8).toString(16)}),K=r=>{typeof r!="string"?r&&typeof r.toString=="function"?console.warn(`[nlux] ${r.toString()}`):console.warn("[nlux]"):console.warn(`[nlux] ${r}`)},In=[],zt=r=>{In.includes(r)||(In.push(r),K(r))},Mr=r=>{var o;const e=["nlux-AiChat-root"],t=`nlux-theme-${r.themeId||"nova"}`,n=r.colorScheme||"auto",s=`nlux-colorScheme-${n==="auto"?typeof globalThis!==void 0&&globalThis.matchMedia&&((o=globalThis.matchMedia("(prefers-color-scheme: dark)"))!=null&&o.matches)?"dark":"light":n}`;return e.push(t),e.push(s),r.className&&e.push(r.className),r.transparentBackground&&e.push("nlux-transparentBackground"),e},Dt={received:"nlux_msg_received",sent:"nlux_msg_sent"},Ht={streaming:"nlux_msg_streaming",complete:"nlux_msg_complete"},En=r=>{if(!(r instanceof HTMLButtonElement)||r.dataset.clickListenerSet==="true")return;let e=!1;const t=r.nextElementSibling;r.addEventListener("click",()=>{if(e||!t)return;const n=t.innerText;navigator.clipboard.writeText(n??""),e=!0,r.classList.add("clicked"),setTimeout(()=>{e=!1,r.classList.remove("clicked")},1e3)}),r.dataset.clickListenerSet="true"},ws=r=>{const e="nlux-comp-copyButton";r instanceof HTMLButtonElement&&r.classList.contains(e)?En(r):r.querySelectorAll(`.${e}`).forEach(En)};function Or(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}let xe={async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null};function Pn(r){xe=r}var zr=Object.defineProperty,bs=(r,e,t)=>((n,s,o)=>s in n?zr(n,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[s]=o)(r,typeof e!="symbol"?e+"":e,t);class Me{constructor(e){bs(this,"options"),this.options=e||xe}postprocess(e){return e}preprocess(e){return e}processAllTokens(e){return e}}bs(Me,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"]));const ys=/[&<>"']/,Dr=new RegExp(ys.source,"g"),vs=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,Hr=new RegExp(vs.source,"g"),jr={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Bn=r=>jr[r];function W(r,e){if(e){if(ys.test(r))return r.replace(Dr,Bn)}else if(vs.test(r))return r.replace(Hr,Bn);return r}const qr=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi;function Nr(r){return r.replace(qr,(e,t)=>(t=t.toLowerCase())==="colon"?":":t.charAt(0)==="#"?t.charAt(1)==="x"?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):"")}const Qr=/(^|[^\[])\^/g;function R(r,e){let t=typeof r=="string"?r:r.source;e=e||"";const n={replace:(s,o)=>{let i=typeof o=="string"?o:o.source;return i=i.replace(Qr,"$1"),t=t.replace(s,i),n},getRegex:()=>new RegExp(t,e)};return n}function Tn(r){try{r=encodeURI(r).replace(/%25/g,"%")}catch{return null}return r}const Oe={exec:()=>null};function Ln(r,e){const t=r.replace(/\|/g,(s,o,i)=>{let a=!1,p=o;for(;--p>=0&&i[p]==="\\";)a=!a;return a?"|":" |"}).split(/ \|/);let n=0;if(t[0].trim()||t.shift(),t.length>0&&!t[t.length-1].trim()&&t.pop(),e)if(t.length>e)t.splice(e);else for(;t.length<e;)t.push("");for(;n<t.length;n++)t[n]=t[n].trim().replace(/\\\|/g,"|");return t}function Ve(r,e,t){const n=r.length;if(n===0)return"";let s=0;for(;s<n;){const o=r.charAt(n-s-1);if(o!==e||t){if(o===e||!t)break;s++}else s++}return r.slice(0,n-s)}const qe=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Cs=/(?:[*+-]|\d{1,9}[.)])/,Ss=R(/^(?!bull |blockCode|fences|blockquote|heading|html)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html))+?)\n {0,3}(=+|-+) *(?:\n+|$)/).replace(/bull/g,Cs).replace(/blockCode/g,/ {4}/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).getRegex(),Gt=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Vt=/(?!\s*\])(?:\\.|[^\[\]\\])+/,$r=R(/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/).replace("label",Vt).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),Ur=R(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,Cs).getRegex(),ft="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",_t=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,Yr=R("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))","i").replace("comment",_t).replace("tag",ft).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Rn=R(Gt).replace("hr",qe).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",ft).getRegex(),en={blockquote:R(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Rn).getRegex(),code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,def:$r,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,hr:qe,html:Yr,lheading:Ss,list:Ur,newline:/^(?: *(?:\n|$))+/,paragraph:Rn,table:Oe,text:/^[^\n]+/},Mn=R("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",qe).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",ft).getRegex(),Fr={...en,table:Mn,paragraph:R(Gt).replace("hr",qe).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Mn).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",ft).getRegex()},Xr={...en,html:R(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",_t).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Oe,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:R(Gt).replace("hr",qe).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Ss).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},As=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Is=/^( {2,}|\\)\n(?!\s*$)/,Ne="\\p{P}\\p{S}",Zr=R(/^((?![*_])[\spunctuation])/,"u").replace(/punctuation/g,Ne).getRegex(),Wr=R(/^(?:\*+(?:((?!\*)[punct])|[^\s*]))|^_+(?:((?!_)[punct])|([^\s_]))/,"u").replace(/punct/g,Ne).getRegex(),Jr=R("^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)[punct](\\*+)(?=[\\s]|$)|[^punct\\s](\\*+)(?!\\*)(?=[punct\\s]|$)|(?!\\*)[punct\\s](\\*+)(?=[^punct\\s])|[\\s](\\*+)(?!\\*)(?=[punct])|(?!\\*)[punct](\\*+)(?!\\*)(?=[punct])|[^punct\\s](\\*+)(?=[^punct\\s])","gu").replace(/punct/g,Ne).getRegex(),Kr=R("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)[punct](_+)(?=[\\s]|$)|[^punct\\s](_+)(?!_)(?=[punct\\s]|$)|(?!_)[punct\\s](_+)(?=[^punct\\s])|[\\s](_+)(?!_)(?=[punct])|(?!_)[punct](_+)(?!_)(?=[punct])","gu").replace(/punct/g,Ne).getRegex(),Gr=R(/\\([punct])/,"gu").replace(/punct/g,Ne).getRegex(),Vr=R(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),_r=R(_t).replace("(?:-->|$)","-->").getRegex(),eo=R("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",_r).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),dt=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,to=R(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",dt).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),On=R(/^!?\[(label)\]\[(ref)\]/).replace("label",dt).replace("ref",Vt).getRegex(),zn=R(/^!?\[(ref)\](?:\[\])?/).replace("ref",Vt).getRegex(),tn={_backpedal:Oe,anyPunctuation:Gr,autolink:Vr,blockSkip:/\[[^[\]]*?\]\([^\(\)]*?\)|`[^`]*?`|<[^<>]*?>/g,br:Is,code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,del:Oe,emStrongLDelim:Wr,emStrongRDelimAst:Jr,emStrongRDelimUnd:Kr,escape:As,link:to,nolink:zn,punctuation:Zr,reflink:On,reflinkSearch:R("reflink|nolink(?!\\()","g").replace("reflink",On).replace("nolink",zn).getRegex(),tag:eo,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,url:Oe},no={...tn,link:R(/^!?\[(label)\]\((.*?)\)/).replace("label",dt).getRegex(),reflink:R(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",dt).getRegex()},jt={...tn,escape:R(As).replace("])","~|])").getRegex(),url:R(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},so={...jt,br:R(Is).replace("{2,}","*").getRegex(),text:R(jt.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},_e={normal:en,gfm:Fr,pedantic:Xr},Ee={normal:tn,gfm:jt,breaks:so,pedantic:no};var ro=Object.defineProperty,vt=(r,e,t)=>((n,s,o)=>s in n?ro(n,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[s]=o)(r,typeof e!="symbol"?e+"":e,t);function Dn(r,e,t,n){const s=e.href,o=e.title?W(e.title):null,i=r[1].replace(/\\([\[\]])/g,"$1");if(r[0].charAt(0)!=="!"){n.state.inLink=!0;const a={type:"link",raw:t,href:s,title:o,text:i,tokens:n.inlineTokens(i)};return n.state.inLink=!1,a}return{type:"image",raw:t,href:s,title:o,text:W(i)}}class ht{constructor(e){vt(this,"lexer"),vt(this,"options"),vt(this,"rules"),this.options=e||xe}autolink(e){const t=this.rules.inline.autolink.exec(e);if(t){let n,s;return t[2]==="@"?(n=W(t[1]),s="mailto:"+n):(n=W(t[1]),s=n),{type:"link",raw:t[0],text:n,href:s,tokens:[{type:"text",raw:n,text:n}]}}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){let n=t[0].replace(/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,`
    $1`);n=Ve(n.replace(/^ *>[ \t]?/gm,""),`
`);const s=this.lexer.state.top;this.lexer.state.top=!0;const o=this.lexer.blockTokens(n);return this.lexer.state.top=s,{type:"blockquote",raw:t[0],tokens:o,text:n}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const n=t[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?n:Ve(n,`
`)}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let n=t[2].replace(/\n/g," ");const s=/[^ ]/.test(n),o=/^ /.test(n)&&/ $/.test(n);return s&&o&&(n=n.substring(1,n.length-1)),n=W(n,!0),{type:"codespan",raw:t[0],text:n}}}def(e){const t=this.rules.block.def.exec(e);if(t){const n=t[1].toLowerCase().replace(/\s+/g," "),s=t[2]?t[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",o=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:n,raw:t[0],href:s,title:o}}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}emStrong(e,t,n=""){let s=this.rules.inline.emStrongLDelim.exec(e);if(s&&!(s[3]&&n.match(/[\p{L}\p{N}]/u))&&(!(s[1]||s[2])||!n||this.rules.inline.punctuation.exec(n))){const o=[...s[0]].length-1;let i,a,p=o,c=0;const l=s[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(l.lastIndex=0,t=t.slice(-1*e.length+o);(s=l.exec(t))!=null;){if(i=s[1]||s[2]||s[3]||s[4]||s[5]||s[6],!i)continue;if(a=[...i].length,s[3]||s[4]){p+=a;continue}if((s[5]||s[6])&&o%3&&!((o+a)%3)){c+=a;continue}if(p-=a,p>0)continue;a=Math.min(a,a+p+c);const h=[...s[0]][0].length,u=e.slice(0,o+s.index+h+a);if(Math.min(o,a)%2){const d=u.slice(1,-1);return{type:"em",raw:u,text:d,tokens:this.lexer.inlineTokens(d)}}const g=u.slice(2,-2);return{type:"strong",raw:u,text:g,tokens:this.lexer.inlineTokens(g)}}}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:W(t[1])}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const n=t[0],s=function(o,i){const a=o.match(/^(\s+)(?:```)/);if(a===null)return i;const p=a[1];return i.split(`
`).map(c=>{const l=c.match(/^\s+/);if(l===null)return c;const[h]=l;return h.length>=p.length?c.slice(p.length):c}).join(`
`)}(n,t[3]||"");return{type:"code",raw:n,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:s}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let n=t[2].trim();if(/#$/.test(n)){const s=Ve(n,"#");this.options.pedantic?n=s.trim():s&&!/ $/.test(s)||(n=s.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:t[0]}}html(e){const t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}inlineText(e){const t=this.rules.inline.text.exec(e);if(t){let n;return n=this.lexer.state.inRawBlock?t[0]:W(t[0]),{type:"text",raw:t[0],text:n}}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}link(e){const t=this.rules.inline.link.exec(e);if(t){const n=t[2].trim();if(!this.options.pedantic&&/^</.test(n)){if(!/>$/.test(n))return;const i=Ve(n.slice(0,-1),"\\");if((n.length-i.length)%2==0)return}else{const i=function(a,p){if(a.indexOf(p[1])===-1)return-1;let c=0;for(let l=0;l<a.length;l++)if(a[l]==="\\")l++;else if(a[l]===p[0])c++;else if(a[l]===p[1]&&(c--,c<0))return l;return-1}(t[2],"()");if(i>-1){const a=(t[0].indexOf("!")===0?5:4)+t[1].length+i;t[2]=t[2].substring(0,i),t[0]=t[0].substring(0,a).trim(),t[3]=""}}let s=t[2],o="";if(this.options.pedantic){const i=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(s);i&&(s=i[1],o=i[3])}else o=t[3]?t[3].slice(1,-1):"";return s=s.trim(),/^</.test(s)&&(s=this.options.pedantic&&!/>$/.test(n)?s.slice(1):s.slice(1,-1)),Dn(t,{href:s&&s.replace(this.rules.inline.anyPunctuation,"$1"),title:o&&o.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer)}}list(e){let t=this.rules.block.list.exec(e);if(t){let n=t[1].trim();const s=n.length>1,o={type:"list",raw:"",ordered:s,start:s?+n.slice(0,-1):"",loose:!1,items:[]};n=s?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=s?n:"[*+-]");const i=new RegExp(`^( {0,3}${n})((?:[	 ][^\\n]*)?(?:\\n|$))`);let a="",p="",c=!1;for(;e;){let l=!1;if(!(t=i.exec(e))||this.rules.block.hr.test(e))break;a=t[0],e=e.substring(a.length);let h=t[2].split(`
`,1)[0].replace(/^\t+/,w=>" ".repeat(3*w.length)),u=e.split(`
`,1)[0],g=0;this.options.pedantic?(g=2,p=h.trimStart()):(g=t[2].search(/[^ ]/),g=g>4?1:g,p=h.slice(g),g+=t[1].length);let d=!1;if(!h&&/^ *$/.test(u)&&(a+=u+`
`,e=e.substring(u.length+1),l=!0),!l){const w=new RegExp(`^ {0,${Math.min(3,g-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),x=new RegExp(`^ {0,${Math.min(3,g-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),y=new RegExp(`^ {0,${Math.min(3,g-1)}}(?:\`\`\`|~~~)`),S=new RegExp(`^ {0,${Math.min(3,g-1)}}#`);for(;e;){const v=e.split(`
`,1)[0];if(u=v,this.options.pedantic&&(u=u.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),y.test(u)||S.test(u)||w.test(u)||x.test(e))break;if(u.search(/[^ ]/)>=g||!u.trim())p+=`
`+u.slice(g);else{if(d||h.search(/[^ ]/)>=4||y.test(h)||S.test(h)||x.test(h))break;p+=`
`+u}d||u.trim()||(d=!0),a+=v+`
`,e=e.substring(v.length+1),h=u.slice(g)}}o.loose||(c?o.loose=!0:/\n *\n *$/.test(a)&&(c=!0));let m,f=null;this.options.gfm&&(f=/^\[[ xX]\] /.exec(p),f&&(m=f[0]!=="[ ] ",p=p.replace(/^\[[ xX]\] +/,""))),o.items.push({type:"list_item",raw:a,task:!!f,checked:m,loose:!1,text:p,tokens:[]}),o.raw+=a}o.items[o.items.length-1].raw=a.trimEnd(),o.items[o.items.length-1].text=p.trimEnd(),o.raw=o.raw.trimEnd();for(let l=0;l<o.items.length;l++)if(this.lexer.state.top=!1,o.items[l].tokens=this.lexer.blockTokens(o.items[l].text,[]),!o.loose){const h=o.items[l].tokens.filter(g=>g.type==="space"),u=h.length>0&&h.some(g=>/\n.*\n/.test(g.raw));o.loose=u}if(o.loose)for(let l=0;l<o.items.length;l++)o.items[l].loose=!0;return o}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const n=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:n,tokens:this.lexer.inline(n)}}}reflink(e,t){let n;if((n=this.rules.inline.reflink.exec(e))||(n=this.rules.inline.nolink.exec(e))){const s=t[(n[2]||n[1]).replace(/\s+/g," ").toLowerCase()];if(!s){const o=n[0].charAt(0);return{type:"text",raw:o,text:o}}return Dn(n,s,n[0],this.lexer)}}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}table(e){const t=this.rules.block.table.exec(e);if(!t||!/[:|]/.test(t[2]))return;const n=Ln(t[1]),s=t[2].replace(/^\||\| *$/g,"").split("|"),o=t[3]&&t[3].trim()?t[3].replace(/\n[ \t]*$/,"").split(`
`):[],i={type:"table",raw:t[0],header:[],align:[],rows:[]};if(n.length===s.length){for(const a of s)/^ *-+: *$/.test(a)?i.align.push("right"):/^ *:-+: *$/.test(a)?i.align.push("center"):/^ *:-+ *$/.test(a)?i.align.push("left"):i.align.push(null);for(const a of n)i.header.push({text:a,tokens:this.lexer.inline(a)});for(const a of o)i.rows.push(Ln(a,i.header.length).map(p=>({text:p,tokens:this.lexer.inline(p)})));return i}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&/^<a /i.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}url(e){var n;let t;if(t=this.rules.inline.url.exec(e)){let s,o;if(t[2]==="@")s=W(t[0]),o="mailto:"+s;else{let i;do i=t[0],t[0]=((n=this.rules.inline._backpedal.exec(t[0]))==null?void 0:n[0])??"";while(i!==t[0]);s=W(t[0]),o=t[1]==="www."?"http://"+t[0]:t[0]}return{type:"link",raw:t[0],text:s,href:o,tokens:[{type:"text",raw:s,text:s}]}}}}var oo=Object.defineProperty,Pe=(r,e,t)=>((n,s,o)=>s in n?oo(n,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[s]=o)(r,typeof e!="symbol"?e+"":e,t);class oe{constructor(e){Pe(this,"options"),Pe(this,"state"),Pe(this,"tokens"),Pe(this,"inlineQueue"),Pe(this,"tokenizer"),this.tokens=[],this.tokens.links=Object.create(null),this.options=e||xe,this.options.tokenizer=this.options.tokenizer||new ht,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={block:_e.normal,inline:Ee.normal};this.options.pedantic?(t.block=_e.pedantic,t.inline=Ee.pedantic):this.options.gfm&&(t.block=_e.gfm,this.options.breaks?t.inline=Ee.breaks:t.inline=Ee.gfm),this.tokenizer.rules=t}static get rules(){return{block:_e,inline:Ee}}static lex(e,t){return new oe(t).lex(e)}static lexInline(e,t){return new oe(t).inlineTokens(e)}blockTokens(e,t=[]){let n,s,o,i;for(e=this.options.pedantic?e.replace(/\t/g,"    ").replace(/^ +$/gm,""):e.replace(/^( *)(\t+)/gm,(a,p,c)=>p+"    ".repeat(c.length));e;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(a=>!!(n=a.call({lexer:this},e,t))&&(e=e.substring(n.raw.length),t.push(n),!0))))if(n=this.tokenizer.space(e))e=e.substring(n.raw.length),n.raw.length===1&&t.length>0?t[t.length-1].raw+=`
`:t.push(n);else if(n=this.tokenizer.code(e))e=e.substring(n.raw.length),s=t[t.length-1],!s||s.type!=="paragraph"&&s.type!=="text"?t.push(n):(s.raw+=`
`+n.raw,s.text+=`
`+n.text,this.inlineQueue[this.inlineQueue.length-1].src=s.text);else if(n=this.tokenizer.fences(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.heading(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.hr(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.blockquote(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.list(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.html(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.def(e))e=e.substring(n.raw.length),s=t[t.length-1],!s||s.type!=="paragraph"&&s.type!=="text"?this.tokens.links[n.tag]||(this.tokens.links[n.tag]={href:n.href,title:n.title}):(s.raw+=`
`+n.raw,s.text+=`
`+n.raw,this.inlineQueue[this.inlineQueue.length-1].src=s.text);else if(n=this.tokenizer.table(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.lheading(e))e=e.substring(n.raw.length),t.push(n);else{if(o=e,this.options.extensions&&this.options.extensions.startBlock){let a=1/0;const p=e.slice(1);let c;this.options.extensions.startBlock.forEach(l=>{c=l.call({lexer:this},p),typeof c=="number"&&c>=0&&(a=Math.min(a,c))}),a<1/0&&a>=0&&(o=e.substring(0,a+1))}if(this.state.top&&(n=this.tokenizer.paragraph(o)))s=t[t.length-1],i&&s.type==="paragraph"?(s.raw+=`
`+n.raw,s.text+=`
`+n.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=s.text):t.push(n),i=o.length!==e.length,e=e.substring(n.raw.length);else if(n=this.tokenizer.text(e))e=e.substring(n.raw.length),s=t[t.length-1],s&&s.type==="text"?(s.raw+=`
`+n.raw,s.text+=`
`+n.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=s.text):t.push(n);else if(e){const a="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(a);break}throw new Error(a)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let n,s,o,i,a,p,c=e;if(this.tokens.links){const l=Object.keys(this.tokens.links);if(l.length>0)for(;(i=this.tokenizer.rules.inline.reflinkSearch.exec(c))!=null;)l.includes(i[0].slice(i[0].lastIndexOf("[")+1,-1))&&(c=c.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+c.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(i=this.tokenizer.rules.inline.blockSkip.exec(c))!=null;)c=c.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+c.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(i=this.tokenizer.rules.inline.anyPunctuation.exec(c))!=null;)c=c.slice(0,i.index)+"++"+c.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;e;)if(a||(p=""),a=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(l=>!!(n=l.call({lexer:this},e,t))&&(e=e.substring(n.raw.length),t.push(n),!0))))if(n=this.tokenizer.escape(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.tag(e))e=e.substring(n.raw.length),s=t[t.length-1],s&&n.type==="text"&&s.type==="text"?(s.raw+=n.raw,s.text+=n.text):t.push(n);else if(n=this.tokenizer.link(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.reflink(e,this.tokens.links))e=e.substring(n.raw.length),s=t[t.length-1],s&&n.type==="text"&&s.type==="text"?(s.raw+=n.raw,s.text+=n.text):t.push(n);else if(n=this.tokenizer.emStrong(e,c,p))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.codespan(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.br(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.del(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.autolink(e))e=e.substring(n.raw.length),t.push(n);else if(this.state.inLink||!(n=this.tokenizer.url(e))){if(o=e,this.options.extensions&&this.options.extensions.startInline){let l=1/0;const h=e.slice(1);let u;this.options.extensions.startInline.forEach(g=>{u=g.call({lexer:this},h),typeof u=="number"&&u>=0&&(l=Math.min(l,u))}),l<1/0&&l>=0&&(o=e.substring(0,l+1))}if(n=this.tokenizer.inlineText(o))e=e.substring(n.raw.length),n.raw.slice(-1)!=="_"&&(p=n.raw.slice(-1)),a=!0,s=t[t.length-1],s&&s.type==="text"?(s.raw+=n.raw,s.text+=n.text):t.push(n);else if(e){const l="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(l);break}throw new Error(l)}}else e=e.substring(n.raw.length),t.push(n);return t}lex(e){e=e.replace(/\r\n|\r/g,`
`),this.blockTokens(e,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){const n=this.inlineQueue[t];this.inlineTokens(n.src,n.tokens)}return this.inlineQueue=[],this.tokens}}var io=Object.defineProperty,ao=(r,e,t)=>((n,s,o)=>s in n?io(n,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[s]=o)(r,e+"",t);class mt{constructor(e){ao(this,"options"),this.options=e||xe}blockquote(e){return`<blockquote>
${e}</blockquote>
`}br(){return"<br>"}checkbox(e){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}code(e,t,n){var o;const s=(o=(t||"").match(/^\S*/))==null?void 0:o[0];return e=e.replace(/\n$/,"")+`
`,s?'<pre><code class="language-'+W(s)+'">'+(n?e:W(e,!0))+`</code></pre>
`:"<pre><code>"+(n?e:W(e,!0))+`</code></pre>
`}codespan(e){return`<code>${e}</code>`}del(e){return`<del>${e}</del>`}em(e){return`<em>${e}</em>`}heading(e,t,n){return`<h${t}>${e}</h${t}>
`}hr(){return`<hr>
`}html(e,t){return e}image(e,t,n){const s=Tn(e);if(s===null)return n;let o=`<img src="${e=s}" alt="${n}"`;return t&&(o+=` title="${t}"`),o+=">",o}link(e,t,n){const s=Tn(e);if(s===null)return n;let o='<a href="'+(e=s)+'"';return t&&(o+=' title="'+t+'"'),o+=">"+n+"</a>",o}list(e,t,n){const s=t?"ol":"ul";return"<"+s+(t&&n!==1?' start="'+n+'"':"")+`>
`+e+"</"+s+`>
`}listitem(e,t,n){return`<li>${e}</li>
`}paragraph(e){return`<p>${e}</p>
`}strong(e){return`<strong>${e}</strong>`}table(e,t){return t&&(t=`<tbody>${t}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+t+`</table>
`}tablecell(e,t){const n=t.header?"th":"td";return(t.align?`<${n} align="${t.align}">`:`<${n}>`)+e+`</${n}>
`}tablerow(e){return`<tr>
${e}</tr>
`}text(e){return e}}class nn{strong(e){return e}em(e){return e}codespan(e){return e}del(e){return e}html(e){return e}text(e){return e}link(e,t,n){return""+n}image(e,t,n){return""+n}br(){return""}}var lo=Object.defineProperty,Ct=(r,e,t)=>((n,s,o)=>s in n?lo(n,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[s]=o)(r,typeof e!="symbol"?e+"":e,t);class ie{constructor(e){Ct(this,"options"),Ct(this,"renderer"),Ct(this,"textRenderer"),this.options=e||xe,this.options.renderer=this.options.renderer||new mt,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new nn}static parse(e,t){return new ie(t).parse(e)}static parseInline(e,t){return new ie(t).parseInline(e)}parse(e,t=!0){let n="";for(let s=0;s<e.length;s++){const o=e[s];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[o.type]){const i=o,a=this.options.extensions.renderers[i.type].call({parser:this},i);if(a!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(i.type)){n+=a||"";continue}}switch(o.type){case"space":continue;case"hr":n+=this.renderer.hr();continue;case"heading":{const i=o;n+=this.renderer.heading(this.parseInline(i.tokens),i.depth,Nr(this.parseInline(i.tokens,this.textRenderer)));continue}case"code":{const i=o;n+=this.renderer.code(i.text,i.lang,!!i.escaped);continue}case"table":{const i=o;let a="",p="";for(let l=0;l<i.header.length;l++)p+=this.renderer.tablecell(this.parseInline(i.header[l].tokens),{header:!0,align:i.align[l]});a+=this.renderer.tablerow(p);let c="";for(let l=0;l<i.rows.length;l++){const h=i.rows[l];p="";for(let u=0;u<h.length;u++)p+=this.renderer.tablecell(this.parseInline(h[u].tokens),{header:!1,align:i.align[u]});c+=this.renderer.tablerow(p)}n+=this.renderer.table(a,c);continue}case"blockquote":{const i=o,a=this.parse(i.tokens);n+=this.renderer.blockquote(a);continue}case"list":{const i=o,a=i.ordered,p=i.start,c=i.loose;let l="";for(let h=0;h<i.items.length;h++){const u=i.items[h],g=u.checked,d=u.task;let m="";if(u.task){const f=this.renderer.checkbox(!!g);c?u.tokens.length>0&&u.tokens[0].type==="paragraph"?(u.tokens[0].text=f+" "+u.tokens[0].text,u.tokens[0].tokens&&u.tokens[0].tokens.length>0&&u.tokens[0].tokens[0].type==="text"&&(u.tokens[0].tokens[0].text=f+" "+u.tokens[0].tokens[0].text)):u.tokens.unshift({type:"text",text:f+" "}):m+=f+" "}m+=this.parse(u.tokens,c),l+=this.renderer.listitem(m,d,!!g)}n+=this.renderer.list(l,a,p);continue}case"html":{const i=o;n+=this.renderer.html(i.text,i.block);continue}case"paragraph":{const i=o;n+=this.renderer.paragraph(this.parseInline(i.tokens));continue}case"text":{let i=o,a=i.tokens?this.parseInline(i.tokens):i.text;for(;s+1<e.length&&e[s+1].type==="text";)i=e[++s],a+=`
`+(i.tokens?this.parseInline(i.tokens):i.text);n+=t?this.renderer.paragraph(a):a;continue}default:{const i='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(i),"";throw new Error(i)}}}return n}parseInline(e,t){t=t||this.renderer;let n="";for(let s=0;s<e.length;s++){const o=e[s];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[o.type]){const i=this.options.extensions.renderers[o.type].call({parser:this},o);if(i!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(o.type)){n+=i||"";continue}}switch(o.type){case"escape":{const i=o;n+=t.text(i.text);break}case"html":{const i=o;n+=t.html(i.text);break}case"link":{const i=o;n+=t.link(i.href,i.title,this.parseInline(i.tokens,t));break}case"image":{const i=o;n+=t.image(i.href,i.title,i.text);break}case"strong":{const i=o;n+=t.strong(this.parseInline(i.tokens,t));break}case"em":{const i=o;n+=t.em(this.parseInline(i.tokens,t));break}case"codespan":{const i=o;n+=t.codespan(i.text);break}case"br":n+=t.br();break;case"del":{const i=o;n+=t.del(this.parseInline(i.tokens,t));break}case"text":{const i=o;n+=t.text(i.text);break}default:{const i='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(i),"";throw new Error(i)}}}return n}}var ze,Hn,qt,co=Object.defineProperty,Es=r=>{throw TypeError(r)},te=(r,e,t)=>((n,s,o)=>s in n?co(n,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[s]=o)(r,typeof e!="symbol"?e+"":e,t),Nt=(r,e,t)=>(((n,s,o)=>{s.has(n)||Es("Cannot "+o)})(r,e,"access private method"),t);ze=new WeakSet,Hn=function(r,e){return t=>{if(t.message+=`
Please report this to https://github.com/markedjs/marked.`,r){const n="<p>An error occurred:</p><pre>"+W(t.message+"",!0)+"</pre>";return e?Promise.resolve(n):n}if(e)return Promise.reject(t);throw t}},qt=function(r,e){return(t,n)=>{const s={...n},o={...this.defaults,...s};this.defaults.async===!0&&s.async===!1&&(o.silent||console.warn("marked(): The async option was set to true by an extension. The async: false option sent to parse will be ignored."),o.async=!0);const i=Nt(this,ze,Hn).call(this,!!o.silent,!!o.async);if(t==null)return i(new Error("marked(): input parameter is undefined or null"));if(typeof t!="string")return i(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));if(o.hooks&&(o.hooks.options=o),o.async)return Promise.resolve(o.hooks?o.hooks.preprocess(t):t).then(a=>r(a,o)).then(a=>o.hooks?o.hooks.processAllTokens(a):a).then(a=>o.walkTokens?Promise.all(this.walkTokens(a,o.walkTokens)).then(()=>a):a).then(a=>e(a,o)).then(a=>o.hooks?o.hooks.postprocess(a):a).catch(i);try{o.hooks&&(t=o.hooks.preprocess(t));let a=r(t,o);o.hooks&&(a=o.hooks.processAllTokens(a)),o.walkTokens&&this.walkTokens(a,o.walkTokens);let p=e(a,o);return o.hooks&&(p=o.hooks.postprocess(p)),p}catch(a){return i(a)}}};const fe=new class{constructor(...r){var e,t,n;e=this,(t=ze).has(e)?Es("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),te(this,"Hooks",Me),te(this,"Lexer",oe),te(this,"Parser",ie),te(this,"Renderer",mt),te(this,"TextRenderer",nn),te(this,"Tokenizer",ht),te(this,"defaults",{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}),te(this,"options",this.setOptions),te(this,"parse",Nt(this,ze,qt).call(this,oe.lex,ie.parse)),te(this,"parseInline",Nt(this,ze,qt).call(this,oe.lexInline,ie.parseInline)),this.use(...r)}lexer(r,e){return oe.lex(r,e??this.defaults)}parser(r,e){return ie.parse(r,e??this.defaults)}setOptions(r){return this.defaults={...this.defaults,...r},this}use(...r){const e=this.defaults.extensions||{renderers:{},childTokens:{}};return r.forEach(t=>{const n={...t};if(n.async=this.defaults.async||n.async||!1,t.extensions&&(t.extensions.forEach(s=>{if(!s.name)throw new Error("extension name required");if("renderer"in s){const o=e.renderers[s.name];e.renderers[s.name]=o?function(...i){let a=s.renderer.apply(this,i);return a===!1&&(a=o.apply(this,i)),a}:s.renderer}if("tokenizer"in s){if(!s.level||s.level!=="block"&&s.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");const o=e[s.level];o?o.unshift(s.tokenizer):e[s.level]=[s.tokenizer],s.start&&(s.level==="block"?e.startBlock?e.startBlock.push(s.start):e.startBlock=[s.start]:s.level==="inline"&&(e.startInline?e.startInline.push(s.start):e.startInline=[s.start]))}"childTokens"in s&&s.childTokens&&(e.childTokens[s.name]=s.childTokens)}),n.extensions=e),t.renderer){const s=this.defaults.renderer||new mt(this.defaults);for(const o in t.renderer){if(!(o in s))throw new Error(`renderer '${o}' does not exist`);if(o==="options")continue;const i=o,a=t.renderer[i],p=s[i];s[i]=(...c)=>{let l=a.apply(s,c);return l===!1&&(l=p.apply(s,c)),l||""}}n.renderer=s}if(t.tokenizer){const s=this.defaults.tokenizer||new ht(this.defaults);for(const o in t.tokenizer){if(!(o in s))throw new Error(`tokenizer '${o}' does not exist`);if(["options","rules","lexer"].includes(o))continue;const i=o,a=t.tokenizer[i],p=s[i];s[i]=(...c)=>{let l=a.apply(s,c);return l===!1&&(l=p.apply(s,c)),l}}n.tokenizer=s}if(t.hooks){const s=this.defaults.hooks||new Me;for(const o in t.hooks){if(!(o in s))throw new Error(`hook '${o}' does not exist`);if(o==="options")continue;const i=o,a=t.hooks[i],p=s[i];Me.passThroughHooks.has(o)?s[i]=c=>{if(this.defaults.async)return Promise.resolve(a.call(s,c)).then(h=>p.call(s,h));const l=a.call(s,c);return p.call(s,l)}:s[i]=(...c)=>{let l=a.apply(s,c);return l===!1&&(l=p.apply(s,c)),l}}n.hooks=s}if(t.walkTokens){const s=this.defaults.walkTokens,o=t.walkTokens;n.walkTokens=function(i){let a=[];return a.push(o.call(this,i)),s&&(a=a.concat(s.call(this,i))),a}}this.defaults={...this.defaults,...n}}),this}walkTokens(r,e){var n,s;let t=[];for(const o of r)switch(t=t.concat(e.call(this,o)),o.type){case"table":{const i=o;for(const a of i.header)t=t.concat(this.walkTokens(a.tokens,e));for(const a of i.rows)for(const p of a)t=t.concat(this.walkTokens(p.tokens,e));break}case"list":{const i=o;t=t.concat(this.walkTokens(i.items,e));break}default:{const i=o;(s=(n=this.defaults.extensions)==null?void 0:n.childTokens)!=null&&s[i.type]?this.defaults.extensions.childTokens[i.type].forEach(a=>{const p=i[a].flat(1/0);t=t.concat(this.walkTokens(p,e))}):i.tokens&&(t=t.concat(this.walkTokens(i.tokens,e)))}}return t}};function z(r,e){return fe.parse(r,e)}z.options=z.setOptions=function(r){return fe.setOptions(r),z.defaults=fe.defaults,Pn(z.defaults),z},z.getDefaults=Or,z.defaults=xe,z.use=function(...r){return fe.use(...r),z.defaults=fe.defaults,Pn(z.defaults),z},z.walkTokens=function(r,e){return fe.walkTokens(r,e)},z.parseInline=fe.parseInline,z.Parser=ie,z.parser=ie.parse,z.Renderer=mt,z.TextRenderer=nn,z.Lexer=oe,z.lexer=oe.lex,z.Tokenizer=ht,z.Hooks=Me,z.parse=z;const Ps=(r,e)=>{const{showCodeBlockCopyButton:t,markdownLinkTarget:n,syntaxHighlighter:s,htmlSanitizer:o}=e||{},i=z(r,{async:!1,breaks:!0});if(typeof i!="string")throw new Error("Markdown parsing failed");const a=document.createElement("div");return a.innerHTML=o?o(i):i,a.querySelectorAll("pre").forEach(p=>{const c=document.createElement("div");c.className="code-block";const l=p.querySelector("code");if(!l){const d=p.innerHTML;return c.innerHTML=o?o(d):d,void p.replaceWith(c)}let h;for(let d=0;d<l.classList.length;d++){const m=l.classList[d];if(m.startsWith("language-")){h=m.slice(9);break}}const u=document.createElement("pre"),g="<div>"+l.innerHTML+"</div>";if(u.innerHTML=e!=null&&e.htmlSanitizer?e.htmlSanitizer(g):g,h&&(u.setAttribute("data-language",h),s)){const d="<div>"+s.createHighlighter()(l.textContent||"",h)+"</div>";u.innerHTML=o?o(d):d,u.className="highlighter-dark"}(d=>{d.replaceChildren()})(c),c.appendChild(u),p.replaceWith(c)}),t!==!1&&a.querySelectorAll(".code-block").forEach(p=>{var u;if(!p.querySelector("pre")||(u=p.previousElementSibling)!=null&&u.classList.contains("nlux-comp-copyButton"))return;const c="Copy code block to clipboard",l=document.createElement("button");l.classList.add("nlux-comp-copyButton"),l.setAttribute("aria-label",c),l.setAttribute("title",c);const h=document.createElement("span");h.classList.add("icon-copy"),l.appendChild(h),p.insertAdjacentElement("beforebegin",l)}),n!=="self"&&a.querySelectorAll("a").forEach(p=>{p.setAttribute("target","_blank")}),a.innerHTML},Bs="nlux-comp-message",jn={received:"nlux-comp-chatItem--received",sent:"nlux-comp-chatItem--sent"},uo="nlux-comp-chatItem--bubblesLayout",po="nlux-comp-chatItem--listLayout",ho=r=>{const{markdownOptions:e}=r,t=k.useRef(null),n=k.useMemo(()=>r.content?Ps(r.content,{syntaxHighlighter:e==null?void 0:e.syntaxHighlighter,htmlSanitizer:e==null?void 0:e.htmlSanitizer,markdownLinkTarget:e==null?void 0:e.markdownLinkTarget,showCodeBlockCopyButton:e==null?void 0:e.showCodeBlockCopyButton}):"",[r.content,e==null?void 0:e.markdownLinkTarget,e==null?void 0:e.syntaxHighlighter,e==null?void 0:e.htmlSanitizer,e==null?void 0:e.showCodeBlockCopyButton]);k.useEffect(()=>{t.current&&(e==null?void 0:e.showCodeBlockCopyButton)!==!1&&ws(t.current)},[n,t.current,e==null?void 0:e.showCodeBlockCopyButton]);const s=k.useMemo(()=>e!=null&&e.htmlSanitizer?e.htmlSanitizer(n):n,[n,e==null?void 0:e.htmlSanitizer]);return b.jsx(Ts,{children:b.jsx("div",{className:"nlux-markdownStream-root",children:b.jsx("div",{className:"nlux-markdown-container",ref:t,dangerouslySetInnerHTML:{__html:s}})})})};class Ts extends k.Component{constructor(){super(...arguments),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e){K("Markdown rendering error occurred. This could be due to a malformed markdown content, or it could be because the page requires an HTML sanitizer. Please check the error message for more details and consider configuring NLUX with a compatible sanitizer."),this.props.onMarkdownRenderingError&&this.props.onMarkdownRenderingError(e)}render(){return this.state.hasError?null:this.props.children}}const qn=r=>b.jsx(Ts,{children:b.jsx(ho,{...r})}),mo=(r,e)=>{let t=!1;const{onComplete:n}=e||{},s=[],o=(e!=null&&e.skipStreamingAnimation?"timeout":"animationFrame")=="timeout"?h=>setTimeout(h,0):h=>requestAnimationFrame(h),i=document.createElement("div");i.classList.add("md-in-progress"),r.append(i);const a=()=>{for(;i.firstChild;){const h=i.firstChild;h instanceof HTMLElement&&ws(h),i.before(h)}},p=!(e!=null&&e.skipStreamingAnimation)&&(e!=null&&e.streamingAnimationSpeed)&&e.streamingAnimationSpeed>=0?e.streamingAnimationSpeed:e!=null&&e.skipStreamingAnimation?0:8,c={timeSinceLastProcessing:new Date().getTime(),currentMarkdown:"",previousHtml:void 0};let l=setInterval(()=>{const h=new Date().getTime(),u=(e==null?void 0:e.waitTimeBeforeStreamCompletion)!=="never";if(s.length===0&&u){const d=typeof(e==null?void 0:e.waitTimeBeforeStreamCompletion)=="number"?e.waitTimeBeforeStreamCompletion:2e3;return void((t||h-c.timeSinceLastProcessing>d)&&(t=!0,l&&(clearInterval(l),l=void 0),a(),i.remove(),n==null?void 0:n()))}c.timeSinceLastProcessing=h;const g=s.shift();g&&o(()=>{const d=c.currentMarkdown+g,m=Ps(d,e).trim();if(typeof m!="string")return c.currentMarkdown=c.currentMarkdown.slice(0,-g.length),void K("Markdown parsing failed");if(c.previousHtml&&m.length>c.previousHtml.length&&m.startsWith(c.previousHtml)){a();const f=m.slice(c.previousHtml.length).trim();i.innerHTML=e!=null&&e.htmlSanitizer?e.htmlSanitizer(f):f,c.currentMarkdown=g,c.previousHtml=void 0}else i.innerHTML=e!=null&&e.htmlSanitizer?e.htmlSanitizer(m):m,c.currentMarkdown=d,c.previousHtml=m})},p);return{next:h=>{if(t)K("Stream is already complete. No more chunks can be added");else for(const u of h)s.push(u)},complete:()=>{t=!0},error:()=>{t=!0}}},go=function(r,e){const{uid:t,status:n,responseRenderer:s,markdownOptions:o,initialMarkdownMessage:i,markdownContainersController:a}=r,[p,c]=k.useState([]),l=k.useRef(null),h=k.useRef(null),u=k.useRef(null),g=k.useRef(null),[d,m]=k.useState();k.useEffect(()=>{l.current!==h.current&&(h.current=l.current,m(l.current||void 0))}),k.useEffect(()=>{if(d){const w=a.getStreamingDomElement(t);d.append(w)}},[d]),k.useEffect(()=>{g.current=w=>{c(x=>[...x,w])}},[c]),k.useEffect(()=>{const w=a.getStreamingDomElement(t);return u.current=mo(w,{syntaxHighlighter:o==null?void 0:o.syntaxHighlighter,htmlSanitizer:o==null?void 0:o.htmlSanitizer,markdownLinkTarget:o==null?void 0:o.markdownLinkTarget,showCodeBlockCopyButton:o==null?void 0:o.showCodeBlockCopyButton,skipStreamingAnimation:o==null?void 0:o.skipStreamingAnimation,streamingAnimationSpeed:o==null?void 0:o.streamingAnimationSpeed,waitTimeBeforeStreamCompletion:o==null?void 0:o.waitTimeBeforeStreamCompletion}),i&&u.current.next(i),()=>{a.deleteStreamingDomElement(t)}},[]),k.useEffect(()=>()=>{h.current=null,u.current=null,g.current=null,m(void 0)},[]),k.useImperativeHandle(e,()=>({streamChunk:w=>{var x,y;g.current&&((x=g.current)==null||x.call(g,w)),typeof w=="string"&&((y=u.current)==null||y.next(w))},completeStream:()=>{var w;(w=u.current)==null||w.complete()}}),[]);const f=s||void 0;return b.jsxs("div",{className:`${Bs} ${Ht[n]} ${Dt.received}`,children:[f&&b.jsx(f,{uid:t,status:n,containerRef:l,content:p,serverResponse:[],dataTransferMode:"stream"}),!f&&b.jsx("div",{className:"nlux-markdownStream-root",ref:l})]})},Ls=r=>{const e=typeof r.avatar=="string",t=!e&&k.isValidElement(r.avatar);return b.jsxs("div",{className:"nlux-comp-avatar",children:[t&&r.avatar,!t&&e&&b.jsx("div",{className:"nlux-comp-avatarContainer",children:r.avatar&&b.jsx("div",{className:"nlux-comp-avatarPicture",style:{backgroundImage:`url("${encodeURI(r.avatar)}")`}})})]})},Nn=function(r){const e=r.status?Ht[r.status]:Ht.rendered,t=r.direction?Dt[r.direction]:Dt.received,n=`${Bs} ${e} ${t}`;if(r.status==="streaming")return b.jsx("div",{className:n});const s=typeof r.message=="function"?b.jsx(r.message,{}):r.message;return b.jsx("div",{className:n,children:s})},fo=function(r,e){var g,d,m,f,w,x,y,S,v,P,A,B,E;const t=k.useMemo(()=>b.jsxs("div",{className:"nlux-comp-chatItem-participantInfo",children:[r.avatar!==void 0&&b.jsx(Ls,{name:r.name,avatar:r.avatar}),b.jsx("span",{className:"nlux-comp-chatItem-participantName",children:r.name})]}),[r.avatar,r.name]),n=k.useRef(null);k.useImperativeHandle(e,()=>({streamChunk:T=>setTimeout(()=>{var H;return(H=n==null?void 0:n.current)==null?void 0:H.streamChunk(T)}),completeStream:()=>setTimeout(()=>{var T;return(T=n==null?void 0:n.current)==null?void 0:T.completeStream()})}),[]);const s=r.direction?jn[r.direction]:jn.received,o=r.layout==="bubbles"?uo:po,i=`nlux-comp-chatItem ${s} ${o} ${o}`,a=k.useMemo(()=>function(T,H){const{uid:N,dataTransferMode:j,status:de,fetchedContent:$,streamedContent:q,streamedServerResponse:re,fetchedServerResponse:Qe,direction:$e,messageOptions:D}=T,kt={current:null};if((D==null?void 0:D.responseRenderer)!==void 0){if(j==="stream"){const _={uid:N,status:de,dataTransferMode:j,content:q??[],serverResponse:re??[],containerRef:kt};return()=>{const we=D.responseRenderer;return b.jsx(we,{..._})}}{const _={uid:N,status:"complete",content:$?[$]:[],serverResponse:Qe?[Qe]:[],dataTransferMode:j};return()=>{const we=D.responseRenderer;return b.jsx(we,{..._})}}}if($e==="sent"){if(typeof $=="string"){const _=$;return()=>b.jsx(b.Fragment,{children:_})}return()=>""}if(typeof $=="string"){const _=$;return()=>b.jsx(qn,{messageUid:N,content:_,markdownOptions:{syntaxHighlighter:D==null?void 0:D.syntaxHighlighter,htmlSanitizer:D==null?void 0:D.htmlSanitizer,markdownLinkTarget:D==null?void 0:D.markdownLinkTarget,showCodeBlockCopyButton:D==null?void 0:D.showCodeBlockCopyButton,skipStreamingAnimation:D==null?void 0:D.skipStreamingAnimation}})}return()=>""}(r),[r.uid,r.status,r.dataTransferMode,r.fetchedContent,r.streamedContent,r.direction,(g=r.messageOptions)==null?void 0:g.responseRenderer,(d=r.messageOptions)==null?void 0:d.syntaxHighlighter,(m=r.messageOptions)==null?void 0:m.htmlSanitizer,(f=r.messageOptions)==null?void 0:f.markdownLinkTarget]),p=k.useCallback(()=>{var H,N;if(((H=r.messageOptions)==null?void 0:H.promptRenderer)===void 0)return b.jsx(qn,{messageUid:r.uid,content:r.fetchedContent,markdownOptions:{htmlSanitizer:(N=r.messageOptions)==null?void 0:N.htmlSanitizer}});const T=r.messageOptions.promptRenderer;return b.jsx(T,{uid:r.uid,prompt:r.fetchedContent})},[(w=r.messageOptions)==null?void 0:w.promptRenderer,r.fetchedContent,r.uid]),c=k.useMemo(()=>k.forwardRef(go),[]),l=r.direction==="received",h=r.direction==="sent",u=r.dataTransferMode==="stream";return b.jsxs("div",{className:i,children:[t,l&&u&&b.jsx(c,{uid:r.uid,status:r.status,ref:n,direction:r.direction,responseRenderer:(x=r.messageOptions)==null?void 0:x.responseRenderer,markdownContainersController:r.markdownContainersController,markdownOptions:{syntaxHighlighter:(y=r.messageOptions)==null?void 0:y.syntaxHighlighter,htmlSanitizer:(S=r.messageOptions)==null?void 0:S.htmlSanitizer,markdownLinkTarget:(v=r.messageOptions)==null?void 0:v.markdownLinkTarget,showCodeBlockCopyButton:(P=r.messageOptions)==null?void 0:P.showCodeBlockCopyButton,skipStreamingAnimation:(A=r.messageOptions)==null?void 0:A.skipStreamingAnimation,streamingAnimationSpeed:(B=r.messageOptions)==null?void 0:B.streamingAnimationSpeed,waitTimeBeforeStreamCompletion:(E=r.messageOptions)==null?void 0:E.waitTimeBeforeStreamCompletion}},"do-not-change"),l&&!u&&b.jsx(Nn,{uid:r.uid,message:a,status:r.status,direction:r.direction}),h&&b.jsx(Nn,{uid:r.uid,message:p,status:r.status,direction:r.direction})]})},Qn=r=>typeof r=="string"||typeof r=="number"||typeof r=="boolean"||r==null,et=(r,e)=>{var t,n;return r==="assistant"?((t=e==null?void 0:e.assistant)==null?void 0:t.name)??"AI":r==="user"?((n=e==null?void 0:e.user)==null?void 0:n.name)??"You":""},tt=(r,e)=>{var t,n;return r==="assistant"?(t=e==null?void 0:e.assistant)==null?void 0:t.avatar:r==="user"?(n=e==null?void 0:e.user)==null?void 0:n.avatar:void 0},ko=function(r,e){const{chatSegment:t,containerRef:n}=r,[s,o]=k.useState(!1),i=k.useMemo(()=>new Map,[]),a=k.useMemo(()=>new Map,[]);k.useEffect(()=>{if(t.items.length===0)return void i.clear();const u=new Set(i.keys()),g=new Set(t.items.map(d=>d.uid));u.forEach(d=>{g.has(d)||i.delete(d)})},[t.items]);const p=k.useMemo(()=>t.status!=="active"?null:b.jsx("div",{className:"nlux-chatSegment-loader-container",children:r.Loader}),[t.status,r.Loader]),c=k.useMemo(()=>(u=>{const g="nlux-chatSegment";return u==="complete"?`${g} nlux-chatSegment--complete`:u==="error"?`${g} nlux-chatSegment--error`:`${g} nlux-chatSegment--active`})(t.status),[t.status]);k.useImperativeHandle(e,()=>({streamChunk:(u,g)=>{const d=i.get(u);if(d!=null&&d.current)d.current.streamChunk(g);else{const m=a.get(u)??[];a.set(u,[...m,g])}},completeStream:u=>{const g=i.get(u);g!=null&&g.current?(g.current.completeStream(),i.delete(u)):o(!0)}}),[]);const l=k.useMemo(()=>k.forwardRef(fo),[]);k.useEffect(()=>{a.size>0&&a.forEach((u,g)=>{const d=i.get(g);d!=null&&d.current&&(u.forEach(m=>{var f;(f=d==null?void 0:d.current)==null||f.streamChunk(m)}),a.delete(g),s&&(d.current.completeStream(),o(!1)))})});const h=t.items;return h.length===0?null:b.jsxs("div",{className:c,ref:n,children:[h.map((u,g)=>{var m;let d=i.get(u.uid);return d||(d=k.createRef(),i.set(u.uid,d)),u.participantRole==="user"?u.status!=="complete"?(zt(`User chat item should be always be in complete state — Current status: ${u.status} — Segment UID: ${t.uid}`),null):Qn(u.content)?b.jsx(l,{ref:d,uid:u.uid,status:"complete",direction:"sent",layout:r.layout,messageOptions:r.messageOptions,dataTransferMode:"batch",fetchedContent:u.content,name:et(u.participantRole,r.personaOptions),avatar:tt(u.participantRole,r.personaOptions),markdownContainersController:r.markdownContainersController},u.uid):(zt(`User chat item should have primitive content (string, number, boolean, null) — Current content: ${JSON.stringify(u.content)} — Segment UID: ${t.uid}`),null):u.status==="complete"?u.dataTransferMode==="stream"?b.jsx(l,{ref:d,uid:u.uid,status:u.status,direction:"received",layout:r.layout,messageOptions:r.messageOptions,dataTransferMode:u.dataTransferMode,streamedContent:u.content,name:et(u.participantRole,r.personaOptions),avatar:tt(u.participantRole,r.personaOptions),markdownContainersController:r.markdownContainersController},u.uid):Qn(u.content)||(m=r.messageOptions)!=null&&m.responseRenderer?b.jsx(l,{ref:d,uid:u.uid,status:"complete",direction:"received",layout:r.layout,messageOptions:r.messageOptions,dataTransferMode:u.dataTransferMode,fetchedContent:u.content,fetchedServerResponse:u.serverResponse,name:et(u.participantRole,r.personaOptions),avatar:tt(u.participantRole,r.personaOptions),markdownContainersController:r.markdownContainersController},u.uid):(K(`When the type of the AI chat content is not primitive (object or array), a custom renderer must be provided — Current content: ${JSON.stringify(u.content)} — Segment UID: ${t.uid}`),null):u.status==="streaming"?b.jsx(l,{ref:d,uid:u.uid,status:"streaming",direction:"received",layout:r.layout,messageOptions:r.messageOptions,dataTransferMode:u.dataTransferMode,name:et(u.participantRole,r.personaOptions),avatar:tt(u.participantRole,r.personaOptions),markdownContainersController:r.markdownContainersController},u.uid):null}),p]})},xo=function(r,e){const{segments:t,personaOptions:n,conversationOptions:s,onLastActiveSegmentChange:o}=r,i=k.createRef();(function(l,h,u){const g=k.useMemo(()=>{const m=l.length>0?l[l.length-1]:void 0;return(m==null?void 0:m.status)==="active"?m.uid:void 0},[l]),d=k.useRef(void 0);k.useEffect(()=>{if(!u)return;const m=d.current;if(g===(m==null?void 0:m.uid)&&h.current===(m==null?void 0:m.div))return;const f=g&&h.current?{uid:g,div:h.current}:void 0;(f||d.current)&&(u(f),d.current=f)})})(t,i,o);const a=function(l){const h=k.useMemo(()=>new Map,[]);return k.useEffect(()=>{if(l.length===0)return void h.clear();const u=new Set(h.keys()),g=new Set(l.map(d=>d.uid));u.forEach(d=>{g.has(d)||h.delete(d)})},[l]),{get:u=>{var g;return(g=h.get(u))==null?void 0:g.current},getRef:u=>h.get(u),set:(u,g)=>{h.set(u,g)},remove:u=>{h.delete(u)}}}(t),p=(l=>k.useMemo(()=>{return h=l==null?void 0:l.layout,h??"list";var h},[l==null?void 0:l.layout]))(s);k.useImperativeHandle(e,()=>({streamChunk:(l,h,u)=>{const g=a.get(l);g==null||g.streamChunk(h,u)},completeStream:(l,h)=>{const u=a.get(l);u==null||u.completeStream(h)}}),[]);const c=k.useMemo(()=>k.forwardRef(ko),[]);return b.jsx("div",{className:"nlux-chatSegments-container",children:t.map((l,h)=>{const u=h===t.length-1;let g=a.getRef(l.uid);return g||(g=k.createRef(),a.set(l.uid,g)),b.jsx(c,{ref:g,containerRef:u?i:void 0,markdownContainersController:r.markdownContainersController,chatSegment:l,layout:p,personaOptions:n,messageOptions:r.messageOptions,Loader:r.Loader},l.uid)})})},wo={typing:"nlux-composer--typing","submitting-prompt":"nlux-composer--submitting","submitting-conversation-starter":"nlux-composer--submitting",waiting:"nlux-composer--waiting"},bo=()=>b.jsx("div",{className:"nlux-comp-sendIcon",children:b.jsx("div",{className:"nlux-comp-sendIcon-container"})}),yo=r=>{const e=`nlux-comp-composer ${wo[r.status]||""}`,t=r.status==="submitting-conversation-starter"||r.status==="submitting-prompt",n=!r.hasValidInput||r.status==="submitting-conversation-starter"||r.status==="submitting-prompt"||r.status==="waiting",s=r.status==="typing",o=k.useRef(null);k.useEffect(()=>{r.status==="typing"&&r.autoFocus&&o.current&&o.current.focus()},[r.status,r.autoFocus,o.current]);const i=k.useMemo(()=>c=>{var l;(l=r.onChange)==null||l.call(r,c.target.value)},[r.onChange]),a=k.useMemo(()=>()=>{var c;(c=r.onSubmit)==null||c.call(r)},[r.onSubmit]),p=k.useMemo(()=>c=>{if(r.submitShortcut&&r.submitShortcut!=="Enter")r.submitShortcut==="CommandEnter"&&c.key==="Enter"&&(c.getModifierState("Control")||c.getModifierState("Meta"))&&(a(),c.preventDefault());else{const l=c.key==="Enter",h=c.altKey||c.ctrlKey||c.metaKey||c.shiftKey;l&&!h&&(a(),c.preventDefault())}},[a,r.submitShortcut]);return b.jsxs("div",{className:e,children:[b.jsx("textarea",{tabIndex:0,ref:o,disabled:t,placeholder:r.placeholder,value:r.prompt,onChange:i,onKeyDown:p}),b.jsxs("button",{tabIndex:0,disabled:n,onClick:()=>{var c;return(c=r.onSubmit)==null?void 0:c.call(r)},children:[s&&b.jsx(bo,{}),!s&&r.Loader]})]})},Qt=r=>{const e={},t=Object.keys(r);for(let n=0;n<t.length;n++){const s=t[n];s!=="personaOptions"&&s!=="messageOptions"&&s!=="adapter"&&s!=="events"&&Object.assign(e,{[s]:r[s]})}return r.personaOptions&&(e.personaOptions={},r.personaOptions.assistant&&(e.personaOptions.assistant={name:r.personaOptions.assistant.name,avatar:typeof r.personaOptions.assistant.avatar=="string"?r.personaOptions.assistant.avatar:"<REACT ELEMENT />",tagline:r.personaOptions.assistant.tagline}),r.personaOptions.user&&(e.personaOptions.user={name:r.personaOptions.user.name,avatar:typeof r.personaOptions.user.avatar=="string"?r.personaOptions.user.avatar:"<REACT ELEMENT />"})),r.messageOptions&&(e.messageOptions={...r.messageOptions,responseRenderer:r.messageOptions.responseRenderer?()=>null:void 0,promptRenderer:r.messageOptions.promptRenderer?()=>null:void 0}),e};var vo=Object.defineProperty,nt=(r,e,t)=>((n,s,o)=>s in n?vo(n,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[s]=o)(r,typeof e!="symbol"?e+"":e,t);class Co extends Error{constructor(e={}){super(e.message),nt(this,"exceptionId"),nt(this,"message"),nt(this,"source"),nt(this,"type"),this.message=e.message??"",this.source=e.source,this.type=this.constructor.name,this.exceptionId=e.exceptionId}}const So=(r,e)=>{let t,n=e,s=r,o=!0;const i=((m,f)=>{let w=!1;if(typeof m!="function")throw new Co({source:"x/throttle",message:"Callback must be a function"});return(...x)=>{w||(m.apply(void 0,x),w=!0,setTimeout(function(){w=!1},f))}})((m=>{let f,w;return x=>{const y=x.target;if(!(y instanceof HTMLElement))return;const{scrollTop:S,clientHeight:v,scrollHeight:P}=y,A=P-30,B=Math.ceil(S+v)>=A,E=f===void 0||w===void 0?void 0:S>f&&w===P?"down":S<f&&w===P?"up":void 0;w=P,f=S,m({scrolledToBottom:B,scrollDirection:E})}})(({scrolledToBottom:m,scrollDirection:f})=>{o?f==="up"&&(o=!1):f==="down"&&m&&(o=!0)}),50),a=m=>{m.addEventListener("scroll",i)},p=m=>{m==null||m.removeEventListener("scroll",i)},c=m=>{(t==null?void 0:t.uid)===m&&(l==null||l.disconnect(),h==null||h.disconnect(),t=void 0,l=void 0,h=void 0)};let l,h;const u=()=>{s==null||s.scrollTo({top:5e4,behavior:"instant"})},g=()=>{s&&n&&o&&u()},d=()=>{g()};return a(s),{updateConversationContainer:m=>{p(s),a(m),s=m},updateProps:({autoScroll:m})=>{n=m},handleNewChatSegmentAdded:(m,f)=>{t&&(l==null||l.disconnect(),h==null||h.disconnect()),t={uid:m,container:f},l=new ResizeObserver(g),l.observe(f),h=new MutationObserver(d),h.observe(f,{childList:!0,subtree:!0,characterData:!0}),n&&u()},handleChatSegmentRemoved:m=>c(m),handleChatSegmentComplete:m=>c(m),destroy:()=>{t&&(c(t.uid),t=void 0),p(s),s=void 0}}},$n=!0,$t=r=>{if(typeof r!="object"||r===null)return!1;const e=r;return(typeof e.streamText=="function"||typeof e.batchText=="function")&&["stream","batch"].includes(e.dataTransferMode)&&typeof e.id=="string"&&typeof e.info=="object"&&e.info!==null&&typeof e.preProcessAiBatchedMessage=="function"&&typeof e.preProcessAiStreamedChunk=="function"},X=r=>{setTimeout(()=>{r()},1)},Ao=(r,e,t,n,s,o,i,a,p)=>new Promise(c=>{const l=ue(),h=[],u=[];let g=!1,d=!1,m=!1;const f=$t(t),w={next:x=>{if(d||m)return;let y,S;if(f){const v=x,P=t.preProcessAiStreamedChunk(v,n);P!=null&&(y=P,S=v,h.push(y),u.push(S))}else y=x,h.push(y);y!=null?(g||g||(g=!0,X(()=>{s.forEach(v=>{v({uid:l,status:"streaming",time:new Date,participantRole:"assistant",dataTransferMode:"stream"})})})),X(()=>{i.forEach(v=>{v({chunk:y,messageId:l,serverResponse:S})})})):K("Adapter returned an undefined or null value from streamText. This chunk will be ignored.")},complete:()=>{d||m||(m=!0,X(()=>{const x={uid:l,status:"complete",content:h,serverResponse:void 0,time:new Date,participantRole:"assistant",dataTransferMode:"stream"};o.forEach(y=>{y(x)}),c()}),X(()=>{const x={uid:r,status:"complete",items:[e,{uid:l,status:"complete",content:h,serverResponse:u,time:new Date,participantRole:"assistant",dataTransferMode:"stream"}]};a.forEach(y=>{y(x)})}))},error:x=>{d||m||(d=!0,X(()=>{p.forEach(y=>{y("failed-to-stream-content",x)}),c()}))}};t.streamText(e.content,w,n)}),Io=(r,e,t)=>{if(!r)return(()=>{const d=new Set,m=ue(),f={uid:m,status:"complete",items:[]};return X(()=>{d.forEach(w=>{w(f)}),d.clear()}),{segment:f,observable:{on:(w,x)=>{w==="complete"&&d.add(x)},removeListener:(w,x)=>{d.delete(x)},destroy:()=>{d.clear()},get segmentId(){return m}},dataTransferMode:"batch"}})();if(e.streamText===void 0&&e.batchText===void 0)return(d=>{const m=new Set,f=ue(),w={uid:f,status:"error",items:[]};return X(()=>{m.forEach(x=>x(d)),m.clear()}),{segment:w,dataTransferMode:"stream",observable:{on:(x,y)=>{x==="error"&&m.add(y)},removeListener:(x,y)=>{m.delete(y)},destroy:()=>{m.clear()},get segmentId(){return f}}}})("no-data-transfer-mode-supported");const n=ue(),s=(d=>({uid:ue(),time:new Date,status:"complete",participantRole:"user",content:d}))(r);let o,i,a,p,c=new Set,l=new Set,h=new Set;X(()=>{c!=null&&c.size&&(c.forEach(d=>{d(s)}),c.clear(),c=void 0)});const u=(d=>{const m=[];d.streamText!==void 0&&m.push("stream"),d.batchText!==void 0&&m.push("batch");const f=$t(d)?d:void 0,w=(f==null?void 0:f.dataTransferMode)??void 0,x=m.length===1?m[0]:"stream";return w??x})(e);u==="batch"?(o=new Set,(async(d,m,f,w,x,y,S)=>{try{const v=m.content,P=$t(f)?f:void 0,A=P!==void 0,B=ue(),E="assistant",T="complete",H=new Date,N="batch";let j;if(A){const q=await P.batchText(v,w),re=P.preProcessAiBatchedMessage(q,w);re!=null&&(j={uid:B,content:re,serverResponse:q,participantRole:E,status:T,time:H,dataTransferMode:N})}else j={uid:B,content:await f.batchText(v,w),serverResponse:void 0,participantRole:E,status:T,time:H,dataTransferMode:N};if(!j)throw new Error("Response from adapter was undefined or cannot be processed");const de=j;X(()=>{x.forEach(q=>{q(de)})});const $={uid:d,status:"complete",items:[m,j]};X(()=>{y.forEach(q=>{q($)})})}catch(v){K(v);const P=v instanceof Error?v:typeof v=="string"?new Error(v):new Error("Unknown error");X(()=>{S.forEach(A=>A("failed-to-load-content",P))})}})(n,s,e,t,o,l,h).finally(()=>{X(()=>g())})):(i=new Set,a=new Set,p=new Set,Ao(n,s,e,t,i,a,p,l,h).finally(()=>{X(()=>g())}));const g=()=>{c==null||c.clear(),c=void 0,o==null||o.clear(),o=void 0,i==null||i.clear(),i=void 0,a==null||a.clear(),a=void 0,p==null||p.clear(),p=void 0,l==null||l.clear(),l=void 0,h==null||h.clear(),h=void 0};return{segment:{status:"active",uid:n,items:[]},dataTransferMode:u,observable:{get segmentId(){return n},on:(d,m)=>{d==="userMessageReceived"&&c?c.add(m):d==="aiMessageReceived"&&o?o.add(m):d==="aiMessageStreamStarted"&&i?i.add(m):d==="aiMessageStreamed"&&a?a.add(m):d==="aiChunkReceived"&&p?p.add(m):d==="complete"&&l?l.add(m):d==="error"&&h&&h.add(m)},removeListener:(d,m)=>{d!=="userMessageReceived"?d!=="aiMessageReceived"?d!=="aiMessageStreamStarted"?d!=="aiMessageStreamed"?d!=="aiChunkReceived"?d!=="complete"?d!=="error"||(h==null||h.delete(m)):l==null||l.delete(m):p==null||p.delete(m):a==null||a.delete(m):i==null||i.delete(m):o==null||o.delete(m):c==null||c.delete(m)},destroy:()=>g()}}},Eo={"data-transfer-mode-not-supported":"Requested data transfer mode is not supported","no-data-transfer-mode-supported":"Adapter does not support any valid data transfer modes","connection-error":"Connection error","invalid-credentials":"Invalid credentials","invalid-api-key":"Invalid API key","http-server-side-error":"HTTP server side error","http-client-side-error":"HTTP client side error","failed-to-load-content":"Failed to load content","failed-to-stream-content":"Failed to stream content","failed-to-render-content":"Failed to display content"},Po=r=>{var w;const{aiChatProps:e,adapterToUse:t,prompt:n,composerOptions:s,showException:o,chatSegments:i,initialSegment:a,setChatSegments:p,setComposerStatus:c,setPrompt:l,conversationRef:h}=r,u=k.useMemo(()=>n.length>0,[n]),g=k.useRef(n);g.current=n;const d=k.useRef({chatSegments:i,setChatSegments:p,setComposerStatus:c,showException:o,setPrompt:l}),m=k.useRef({});k.useEffect(()=>{d.current={chatSegments:i,setChatSegments:p,setComposerStatus:c,showException:o,setPrompt:l}},[i,p,c,o,l]);const f=((x,y,S)=>k.useMemo(()=>{const v=(A=>{const B=[];return A.forEach(E=>{E.items.forEach(T=>{if(T.status==="complete"){if(T.participantRole==="assistant")B.push({role:"assistant",message:T.content});else if(T.participantRole==="user")return B.push({role:"user",message:T.content})}})}),B})(y),P=S==="max"||S===void 0?v:S>0?v.slice(-S):void 0;return{aiChatProps:Qt(x),conversationHistory:P}},[x,y,S]))(e,a?[a,...i]:i,(w=e.conversationOptions)==null?void 0:w.historyPayloadSize);return k.useEffect(()=>{m.current=e.events||{}},[e.events]),k.useCallback(()=>{if(!t)return void K("No valid adapter was provided to AiChat component");if(!u||s!=null&&s.disableSubmitButton)return;c("submitting-prompt");const x=n,y=new Set,{segment:S,observable:v}=Io(x,t,f);if(S.status==="error")return K("Error occurred while submitting prompt"),o("Error occurred while submitting prompt"),c("typing"),void(g.current===""&&l(x));const P=A=>{const B=d.current.chatSegments.map(E=>E.uid!==v.segmentId?E:{...E,items:[...E.items,{...A}]});d.current.setChatSegments(B)};v.on("userMessageReceived",A=>{var B;P(A),(B=m.current)!=null&&B.messageSent&&m.current.messageSent({uid:A.uid,message:A.content})}),v.on("aiMessageStreamStarted",A=>{var B;P(A),d.current.setComposerStatus("waiting"),g.current===x&&d.current.setPrompt(""),y.add(A.uid),(B=m.current)!=null&&B.messageStreamStarted&&m.current.messageStreamStarted({uid:A.uid})}),v.on("aiMessageReceived",A=>{var E;const B=d.current.chatSegments.map(T=>T.uid!==v.segmentId?T:{...T,items:[...T.items,{...A}]});d.current.setChatSegments(B),(E=m.current)!=null&&E.messageReceived&&m.current.messageReceived({uid:A.uid,message:A.content})}),v.on("complete",A=>{d.current.setComposerStatus("typing");const B=d.current.chatSegments.map(E=>E.uid!==v.segmentId?E:{...A});d.current.setChatSegments(B),g.current===x&&l(""),y.size>0&&(y.forEach(E=>{requestAnimationFrame(()=>{var T;(T=h.current)==null||T.completeStream(v.segmentId,E)})}),y.clear())}),v.on("aiChunkReceived",({messageId:A,chunk:B,serverResponse:E})=>{requestAnimationFrame(()=>{var T;(T=h.current)==null||T.streamChunk(S.uid,A,B)})}),v.on("aiMessageStreamed",A=>{var B,E;(B=m.current)!=null&&B.messageReceived&&((E=m.current)==null||E.messageReceived({uid:A.uid,message:A.content}))}),v.on("error",(A,B)=>{var H;const E=d.current.chatSegments.filter(N=>N.uid!==S.uid),T=Eo[A];d.current.setChatSegments(E),d.current.setComposerStatus("typing"),d.current.showException(T),g.current===""&&l(x),(H=m.current)!=null&&H.error&&m.current.error({errorId:A,message:T,errorObject:B})}),d.current.setChatSegments([...d.current.chatSegments,S])},[n,t,f,o,d,s==null?void 0:s.disableSubmitButton])},Rs=r=>b.jsxs("div",{className:"nlux-comp-welcomeMessage",children:[b.jsx(Ls,{avatar:r.avatar,name:r.name}),b.jsx("div",{className:"nlux-comp-welcomeMessage-personaName",children:r.name}),r.message&&b.jsx("div",{className:"nlux-comp-welcomeMessage-text",children:r.message})]}),Bo=()=>{const r=k.useMemo(()=>"data:image/png;base64,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",[]);return b.jsx(Rs,{avatar:r,name:""})},To=r=>{const{onConversationStarterSelected:e}=r;return b.jsx("div",{className:"nlux-comp-conversationStarters",children:r.items.map((t,n)=>b.jsx("button",{className:"nlux-comp-conversationStarter",onClick:()=>e(t),children:b.jsx("span",{className:"nlux-comp-conversationStarter-prompt",children:t.prompt})},n))})},Lo=r=>{const{segments:e,personaOptions:t,conversationOptions:n}=r,s=k.useMemo(()=>e.some(p=>p.items.length>0),[e]),o=k.useMemo(()=>!s&&(t==null?void 0:t.assistant)===void 0&&(n==null?void 0:n.showWelcomeMessage)!==!1,[s,t==null?void 0:t.assistant,n==null?void 0:n.showWelcomeMessage]),i=k.useMemo(()=>!s&&(t==null?void 0:t.assistant)!==void 0&&(n==null?void 0:n.showWelcomeMessage)!==!1,[s,t==null?void 0:t.assistant,n==null?void 0:n.showWelcomeMessage]),a=k.useMemo(()=>!s&&(n==null?void 0:n.conversationStarters)&&(n==null?void 0:n.conversationStarters.length)>0,[s,n==null?void 0:n.conversationStarters]);return b.jsxs(b.Fragment,{children:[o&&b.jsx(Bo,{}),i&&b.jsx(Rs,{name:t.assistant.name,avatar:t.assistant.avatar,message:t.assistant.tagline}),b.jsx("div",{className:"nlux-conversationStarters-container",children:a&&b.jsx(To,{items:n.conversationStarters??[],onConversationStarterSelected:r.onConversationStarterSelected})})]})},Un=()=>b.jsx("div",{className:"nlux-comp-messageLoader",children:b.jsx("div",{className:"nlux-comp-loaderContainer",children:b.jsx("span",{className:"spinning-loader"})})}),Ro={Loader:r=>b.jsx(b.Fragment,{children:r.children})},Mo=function(r){var _,we,sn;const{adapter:e,className:t,initialConversation:n,conversationOptions:s,composerOptions:o,displayOptions:i}=r,{themeId:a,colorScheme:p,transparentBackground:c}=i??{},l=k.useRef(null),h=k.useRef(null),u=k.useRef(void 0),g=k.useRef(null),d=((C,I)=>{const[M,Y]=k.useState(),[ae,G]=k.useState(),Q=k.useRef(M),le=k.useRef(I);return k.useEffect(()=>{const rn=C.current||void 0;rn!==ae&&G(rn)}),k.useEffect(()=>{ae?Q.current?Q.current.updateConversationContainer(ae):(Q.current=So(ae,le.current??$n),Y(Q.current)):Q.current&&(Q.current.destroy(),Y(void 0),Q.current=void 0)},[ae]),k.useEffect(()=>{le.current=I,Q.current&&Q.current.updateProps({autoScroll:I??$n})},[I]),M})(h,s==null?void 0:s.autoScroll),m=k.useMemo(()=>g.current?Rr(g.current):void 0,[g.current]),f=(()=>{const C={},I=new Set;return Math.random().toString(36).substring(7),k.useMemo(()=>({getStreamingDomElement:M=>{if(console.dir(I),I.has(M)&&I.delete(M),C[M]===void 0){const Y=document.createElement("div");Y.setAttribute("nlux-message-id",M),Y.className="nlux-markdown-container",C[M]=Y}return C[M]},deleteStreamingDomElement:M=>{I.add(M),setTimeout(()=>{I.forEach(Y=>{C[Y]&&(C[Y].remove(),delete C[Y])}),I.clear()},1e3)}}),[])})(),[w,x]=k.useState(""),[y,S]=k.useState("typing"),[v,P]=k.useState(),[A,B]=k.useState([]),E=k.useMemo(()=>v?[v,...A]:A,[v,A]),T=k.useMemo(()=>(C=>{const I=C;if(typeof(I==null?void 0:I.create)=="function")return I.create();if(typeof(I==null?void 0:I.batchText)=="function"||typeof(I==null?void 0:I.streamText)=="function")return C;K("Unable to determine the type of the adapter! Missing batchText or streamText method.")})(e),[e]),H=(C=>k.useMemo(()=>{const I={minWidth:"280px",minHeight:"280px"};return C!=null&&C.width&&(I.width=C.width),C!=null&&C.height&&(I.height=C.height),I},[C==null?void 0:C.width,C==null?void 0:C.height]))(i),N=k.useMemo(()=>Mr({className:t,themeId:a,colorScheme:p,transparentBackground:c}).join(" "),[t,a,p,c]),j=k.useCallback(C=>m==null?void 0:m.displayException(C),[m]),de=k.useCallback(C=>x(C),[x]),$=Po({aiChatProps:r,adapterToUse:T,conversationRef:l,initialSegment:v,chatSegments:A,prompt:w,composerOptions:o,showException:j,setChatSegments:B,setComposerStatus:S,setPrompt:x}),q=k.useCallback(C=>{x(C.prompt),S("submitting-conversation-starter")},[x,S]),re=((C,I)=>k.useCallback(M=>{C&&M&&(I.current=M.uid,C.handleNewChatSegmentAdded(M.uid,M.div))},[C]))(d,u);k.useEffect(()=>{y==="submitting-conversation-starter"&&$()},[y,$]),k.useEffect(()=>P(n?{uid:"initial",status:"complete",items:n.map((C,I)=>{if(C.role==="assistant"||C.role==="user")return C.role==="user"?typeof C.message!="string"?void K(`Invalid message type for item at index ${I} in initial conversation: When role is "user", message must be a string`):{uid:ue(),time:new Date,status:"complete",participantRole:"user",content:C.message}:{uid:ue(),time:new Date,status:"complete",participantRole:"assistant",content:C.message,serverResponse:C.serverResponse,dataTransferMode:"batch"};K(`Invalid role for item at index ${I} in initial conversation: Role must be "assistant" or "user"`)}).filter(C=>C!==void 0)}:void 0),[n]),k.useEffect(()=>{var C;v&&((C=h.current)==null||C.scrollTo({behavior:"smooth",top:5e4}))},[v]),(C=>{k.useEffect(()=>{var M;const I=(M=C.events)==null?void 0:M.ready;I&&I({aiChatProps:Qt(C)})},[])})(r),((C,I)=>{var ae;const M=k.useRef(),Y=k.useRef();k.useEffect(()=>{M.current=()=>{const G=[];return I.forEach(Q=>{Q.items&&Q.items.length!==0&&Q.items.forEach(le=>{le.status==="complete"&&(le.participantRole!=="assistant"?le.participantRole==="user"&&G.push({role:"user",message:le.content}):G.push({role:"assistant",message:le.content}))})}),G}},[I]),k.useEffect(()=>{var G;Y.current=(G=C.events)==null?void 0:G.preDestroy},[(ae=C.events)==null?void 0:ae.preDestroy]),k.useEffect(()=>()=>{var Q;const G=Y.current;G&&(G({aiChatProps:Qt(C),conversationHistory:((Q=M.current)==null?void 0:Q.call(M))??[]}),M.current=void 0)},[])})(r,E);const Qe=k.useMemo(()=>k.forwardRef(xo),[]),$e=(C=>{const I=k.useMemo(()=>C.children?Array.isArray(C.children)?C.children:[C.children]:[],[C.children]);return{Loader:k.useMemo(()=>I.length===0?b.jsx(Un,{}):I.find(M=>M.type===Ro.Loader)||b.jsx(Un,{}),[I])}})(r),D=w.length>0,kt=E.length===0?"nlux-chatRoom-starting":"nlux-chatRoom-active";return T?b.jsxs("div",{className:N,style:H,children:[b.jsx("div",{className:"nlux-comp-exceptionBox",ref:g}),b.jsxs("div",{className:`nlux-chatRoom-container ${kt}`,children:[b.jsx("div",{className:"nlux-launchPad-container",children:b.jsx(Lo,{segments:E,onConversationStarterSelected:q,conversationOptions:s,personaOptions:r.personaOptions})}),b.jsx("div",{className:"nlux-conversation-container",ref:h,children:b.jsx(Qe,{ref:l,segments:E,conversationOptions:r.conversationOptions,personaOptions:r.personaOptions,messageOptions:r.messageOptions,onLastActiveSegmentChange:re,Loader:$e.Loader,markdownContainersController:f})}),b.jsx("div",{className:"nlux-composer-container",children:b.jsx(yo,{status:y,prompt:w,hasValidInput:D,placeholder:(_=r.composerOptions)==null?void 0:_.placeholder,autoFocus:(we=r.composerOptions)==null?void 0:we.autoFocus,submitShortcut:(sn=r.composerOptions)==null?void 0:sn.submitShortcut,onChange:de,onSubmit:$,Loader:$e.Loader})})]})]}):(zt("AiChat: No valid adapter provided. The component will not render."),b.jsx(b.Fragment,{}))};var Oo=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")};const zo=Ms(Oo),Do={streamText:(r,e)=>{const t=new zo("ws://localhost:8080");t.onopen=()=>{t.send(JSON.stringify({message:r}))},t.onmessage=n=>{const s=n.data.toString();try{const o=JSON.parse(s);o.choices&&o.choices.length>0?e.next(o.choices[0].text):e.error(new Error("No choices returned in the response"))}catch(o){e.error(o)}},t.onclose=()=>{e.complete()},t.onerror=n=>{const s={name:n.error.name,message:n.error.message,stack:n.error.stack};e.error(s)}}},Ho="https://docs.nlkit.com/nlux/images/personas/hawking.png",jo="https://docs.nlkit.com/nlux/images/personas/marissa.png",qo={assistant:{name:"FlatMate",avatar:Ho,tagline:"Love em All!"},user:{name:"You",avatar:jo}},No=({displayOptions:r,composerOptions:e,conversationOptions:t,messageOptions:n})=>{const s=k.useMemo(()=>Do,[]),o={themeId:"nova",colorScheme:"auto",width:"100%",height:"100%"},i={autoFocus:!0,disableSubmitButton:!1,placeholder:"Tell me about your Berlin rental problems...",submitShortcut:"CommandEnter"},a={layout:"list",autoScroll:!0,showWelcomeMessage:!0,conversationStarters:[{prompt:"Write a poem using markdown and emojis"},{prompt:"What is your name?"},{prompt:"What is your favorite color?"}]},p={markdownLinkTarget:"blank",showCodeBlockCopyButton:!0,skipStreamingAnimation:!1,streamingAnimationSpeed:100,waitTimeBeforeStreamCompletion:5e3};return b.jsx("div",{id:"composer",children:b.jsx(Mo,{className:"theme-flatemate",adapter:s,composerOptions:e||i,personaOptions:qo,conversationOptions:t||a,messageOptions:n||p,displayOptions:r||o})})};try{thread.displayName="thread",thread.__docgenInfo={description:"",displayName:"thread",props:{displayOptions:{defaultValue:null,description:"",name:"displayOptions",required:!1,type:{name:"DisplayOptions | undefined"}},composerOptions:{defaultValue:null,description:"",name:"composerOptions",required:!1,type:{name:"ComposerOptions | undefined"}},conversationOptions:{defaultValue:null,description:"",name:"conversationOptions",required:!1,type:{name:"ConversationOptions | undefined"}},messageOptions:{defaultValue:null,description:"",name:"messageOptions",required:!1,type:{name:"MessageOptions | undefined"}}}}}catch{}const Go={title:"Components/Thread",component:No},st={args:{displayOptions:{themeId:"nova",colorScheme:"auto"},composerOptions:{autoFocus:!0,disableSubmitButton:!1,placeholder:"Tell me about your Berlin rental problems...",submitShortcut:"CommandEnter"},conversationOptions:{layout:"list",autoScroll:!0,showWelcomeMessage:!0,conversationStarters:[{prompt:"Write a poem using markdown and emojis"},{prompt:"What is your name?"},{prompt:"What is your favorite color?"}]},messageOptions:{markdownLinkTarget:"blank",showCodeBlockCopyButton:!0,skipStreamingAnimation:!1,streamingAnimationSpeed:100,waitTimeBeforeStreamCompletion:5e3}}};var Yn,Fn,Xn;st.parameters={...st.parameters,docs:{...(Yn=st.parameters)==null?void 0:Yn.docs,source:{originalSource:`{
  args: {
    displayOptions: {
      themeId: 'nova',
      colorScheme: 'auto'
    },
    composerOptions: {
      autoFocus: true,
      disableSubmitButton: false,
      placeholder: 'Tell me about your Berlin rental problems...',
      submitShortcut: 'CommandEnter'
    },
    conversationOptions: {
      layout: 'list',
      autoScroll: true,
      showWelcomeMessage: true,
      conversationStarters: [{
        prompt: 'Write a poem using markdown and emojis'
      }, {
        prompt: 'What is your name?'
      }, {
        prompt: 'What is your favorite color?'
      }]
    },
    messageOptions: {
      markdownLinkTarget: 'blank',
      showCodeBlockCopyButton: true,
      skipStreamingAnimation: false,
      streamingAnimationSpeed: 100,
      waitTimeBeforeStreamCompletion: 5000
    }
  }
}`,...(Xn=(Fn=st.parameters)==null?void 0:Fn.docs)==null?void 0:Xn.source}}};const Vo=["Default"];export{st as Default,Vo as __namedExportsOrder,Go as default};
